
/*
 ************************************************************************************************************
 *	Create Stored Procedure.																				*
 ************************************************************************************************************
*/

CREATE PROCEDURE [21D365_ods].[usp_Insertcustinvoicetable]

AS

BEGIN

	/*
	 ********************************************************************************************************
	 *	Update the ODSHashValue Field in the Staging table with the Hash value of the record.				*
	 ********************************************************************************************************
	*/

	UPDATE A
	   SET [ODSHashValue] = CAST(HASHBYTES('MD5', ISNULL(SUBSTRING([Id], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([SinkCreatedOn] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL(CAST([SinkModifiedOn] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL([correct_ru], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([correctiontype_ru], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([custfinaluser_br], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([einvoicelinespec], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([fiscaldoctype_pl], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([foreigntrade_mx], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([forinterestadjustment], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([girotype], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([incltax], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([intercompanyposted], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([invoicecomplementarytype], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([listcode], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([manualnumbering_w], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([mcrgiftcard], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([natureofassessee_in], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([nonrealrevenue_ru], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([onetimecustomer], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([posted], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([postponevat], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([presencetype_br], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([printoverduefinetxt_fr], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([servicecodeondlvaddress_br], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([sourcecertificate_mx], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([subledgerjournalstatus], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([taxwithholdcalculate], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([touched], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([unitedvatinvoice_lt], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([vatonpayment_ru], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([workflowapprovalstate], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([workflowapprovalstatus], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([incltax_w], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([provisionalassessment_in], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([withigstpayment_in], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([wouldyouclaimrefund_in], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([usedefaultfromcustomer], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([vatnumtabletype], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([overridesalestax], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([excludefromdecoupledpostingprocess], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([printdynamicqrcode_in], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([invoicetype_w], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([cfditemporaryexport_mx], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([cfdieinvoiceperiod_mx], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([ecsiscommissioninvoice], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([sysdatastatecode], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([tdsgroup_in], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([orderaccount], 1, 255), '') + '|' + 							CAST(ISNULL([accountingdistributiontemplate], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL(CAST([adjustinginvoicedate] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL([agreementheaderext_ru], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([bankaccount_lv], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([bankcentralbankpurposecode], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([bankcentralbankpurposetext], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([cashdiscbasedate] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL([cashdiscbasedays], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([cashdisccode], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([cashdiscdate] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL([cashdiscpercent], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([certificatenumber_mx], 1, 255), '') + '|' + 							CAST(ISNULL([cfoptable_br], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([cfpsid_br], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([complementedinvoiceid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([consigneeaccount_ru], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([consignoraccount_ru], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([contactpersonid], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([correctedfacturedate_ru] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([correctedfactureexternalid_ru], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([correctedinvoicedate_ru] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([correctedinvoiceid_ru], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([correctedperiod_ru] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL([correctionreasoncode], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([covstatus], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([curbankaccount_lv], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([currencycode], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([custbankaccount_lv], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([custbankaccountid], 1, 255), '') + '|' + 							CAST(ISNULL([custbillingclassification], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([custgroup], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([customerref], 1, 255), '') + '|' + 							CAST(ISNULL([defaultdimension], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([fintag], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL(CAST([deliverydate_es] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL([deliverypostaladdress], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([deliverylocation], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([directdebitmandate], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([dlvterm], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([docnumberingcode_lt], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([documentdate] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL(CAST([duedate] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([einvoiceaccountcode], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([enterprisenumber], 1, 255), '') + '|' + 							CAST(ISNULL([exchrate_w], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([finecode_br], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([fiscaladdress_mx], 1, 255), '') + '|' + 							CAST(ISNULL([fiscaldocumenttype_br], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([fiscalestablishment_br], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([interestcode_br], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([intrastatfulfillmentdate_hu] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([invoiceaccount], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([invoicedate] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([invoiceid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([languageid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([log], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([manualinvoiceid_w], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([mcrledgervoucher], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([mcrnumbersequencecode], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([mcrsalesid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([name], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([numbersequencegroup], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([numregidtrib_mx], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([payment], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([paymentsched], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([paymmode], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([paymspec], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([port], 1, 255), '') + '|' + 							CAST(ISNULL([postaladdress], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([postingprofile], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([projintercompany], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([purchorderformnum], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([releasedate] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL(CAST([salesdate_w] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([salesid], 1, 255), '') + '|' + 							CAST(ISNULL([salespurchoperationtype_br], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([satincotermcode_mx], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([satpaymmethod_mx], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([satpurpose_mx], 1, 255), '') + '|' + 							CAST(ISNULL([sourcedocumentheader], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([sourcedocumentline], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([statprocid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([taxgroup], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([taxitemgroup], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([taxperiodpaymentcode_pl], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([tcsgroup_in], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([transactioncode], 1, 255), '') + '|' + 							CAST(ISNULL([transportationdocument], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([transport], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([vatduedate_w] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([vatnum], 1, 255), '') + '|' + 							CAST(ISNULL([workersalestaker], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([orderaccountrefrecid], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([einvoicecfdiconfirmnumber_mx], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([externalinvoiceid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([customerinvoiceoriginid], 1, 255), '') + '|' + 							CAST(ISNULL([vatnumrecid], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([intentletterid_it], 1, 255), '') + '|' + 							CAST(ISNULL([taxid], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([taxinvoicetransactioncode_id], 1, 255), '') + '|' + 							CAST(ISNULL([electronicinvoiceframeworktype_fr], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([servicecode_fr], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([projectmanager_fr], 1, 255), '') + '|' + 							CAST(ISNULL([servicecoderefrecid], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([tamdeductionid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([tamrebatetransid], 1, 255), '') + '|' + 							CAST(ISNULL([rskfxhedgedamount], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([rskfxfixedexchrate], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([ecssettlementcontractid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([lgslogisticfileid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([dctvatfiscalunityid], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([modifieddatetime] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([modifiedby], 1, 255), '') + '|' + 							CAST(ISNULL([modifiedtransactionid], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL(CAST([createddatetime] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([createdby], 1, 255), '') + '|' + 							CAST(ISNULL([createdtransactionid], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([dataareaid], 1, 255), '') + '|' + 							CAST(ISNULL([recversion], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([partition], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([sysrowversion], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([recid], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([tableid], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([versionnumber], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL(CAST([createdon] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL(CAST([modifiedon] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL([IsDelete], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([mcreasoncode1], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([mcreasoncode2], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([mcuuid1], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([mcuuid2], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([PartitionId], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([Ingestion_Timestamp], 1, 255), '')) AS BINARY(16))
	  FROM [21D365_stg].[custinvoicetable] A; 

							 
	/*
	 ********************************************************************************************************
	 *	If the Destination table has no records update the Staging table Record Source with the value (N)ew.*
	 ********************************************************************************************************
	*/

	IF NOT EXISTS (SELECT count(*) FROM [21D365_ods].[custinvoicetable] HAVING count(*) > 0)
	BEGIN
	    UPDATE [21D365_stg].[custinvoicetable]
		   SET [ODSRecordStatus] = 'N'
		 WHERE [ODSRecordStatus] IS NULL
	END;

	/*
	 ********************************************************************************************************
	 *	If the Destination table is not empty Update the ODSRecordStatus with values (N), (C) or (S).		*
	 ********************************************************************************************************
	*/

	IF EXISTS (SELECT count(*) FROM [21D365_ods].[custinvoicetable] HAVING count(*) > 0)
	BEGIN

		UPDATE A
		   SET A.[ODSRecordStatus] = 'N'
		  FROM [21D365_stg].[custinvoicetable] A LEFT JOIN [21D365_ods].[custinvoicetable] B
		    ON A.[recid] = B.[recid]
		 WHERE B.[recid] IS NULL

		UPDATE A
		   SET A.[ODSRecordStatus] = 'C'
		  FROM [21D365_stg].[custinvoicetable] A INNER JOIN [21D365_ods].[custinvoicetable] B
		    ON A.[recid] = B.[recid]
		   AND A.[ODSHashValue] <> B.[ODSHashValue]

		UPDATE A
		   SET A.[ODSRecordStatus] = 'S'
		  FROM [21D365_stg].[custinvoicetable] A INNER JOIN [21D365_ods].[custinvoicetable] B
		    ON A.[recid] = B.[recid]
		   AND A.[ODSHashValue] = B.[ODSHashValue]
	END;				
	/*
	 ********************************************************************************************************
	 *	Update ODS Fields if table Exists.																	*
	 ********************************************************************************************************
	*/

	UPDATE A
	   SET A.[ODSEndDate] = GETDATE(),
		   A.[ODSActive] = CONVERT(BIT, 0)
	  FROM [21D365_ods].[custinvoicetable] A INNER JOIN [21D365_stg].[custinvoicetable] B
	    ON A.[recid] = B.[recid]
	 WHERE B.[ODSRecordStatus] = 'C'
	   AND A.[ODSEndDate] = CONVERT(DATETIME, '31-12-9999', 103)
	   AND A.[ODSActive] = CONVERT(BIT, 1); 
	
	/*
	 ********************************************************************************************************
	 *	Insert New And Changed records in the ODS Table.													*
	 ********************************************************************************************************
	*/

	INSERT INTO [21D365_ods].[custinvoicetable]			(			 [Id],			 [SinkCreatedOn],			 [SinkModifiedOn],			 [correct_ru],			 [correctiontype_ru],			 [custfinaluser_br],			 [einvoicelinespec],			 [fiscaldoctype_pl],			 [foreigntrade_mx],			 [forinterestadjustment],			 [girotype],			 [incltax],			 [intercompanyposted],			 [invoicecomplementarytype],			 [listcode],			 [manualnumbering_w],			 [mcrgiftcard],			 [natureofassessee_in],			 [nonrealrevenue_ru],			 [onetimecustomer],			 [posted],			 [postponevat],			 [presencetype_br],			 [printoverduefinetxt_fr],			 [servicecodeondlvaddress_br],			 [sourcecertificate_mx],			 [subledgerjournalstatus],			 [taxwithholdcalculate],			 [touched],			 [unitedvatinvoice_lt],			 [vatonpayment_ru],			 [workflowapprovalstate],			 [workflowapprovalstatus],			 [incltax_w],			 [provisionalassessment_in],			 [withigstpayment_in],			 [wouldyouclaimrefund_in],			 [usedefaultfromcustomer],			 [vatnumtabletype],			 [overridesalestax],			 [excludefromdecoupledpostingprocess],			 [printdynamicqrcode_in],			 [invoicetype_w],			 [cfditemporaryexport_mx],			 [cfdieinvoiceperiod_mx],			 [ecsiscommissioninvoice],			 [sysdatastatecode],			 [tdsgroup_in],			 [orderaccount],			 [accountingdistributiontemplate],			 [adjustinginvoicedate],			 [agreementheaderext_ru],			 [bankaccount_lv],			 [bankcentralbankpurposecode],			 [bankcentralbankpurposetext],			 [cashdiscbasedate],			 [cashdiscbasedays],			 [cashdisccode],			 [cashdiscdate],			 [cashdiscpercent],			 [certificatenumber_mx],			 [cfoptable_br],			 [cfpsid_br],			 [complementedinvoiceid],			 [consigneeaccount_ru],			 [consignoraccount_ru],			 [contactpersonid],			 [correctedfacturedate_ru],			 [correctedfactureexternalid_ru],			 [correctedinvoicedate_ru],			 [correctedinvoiceid_ru],			 [correctedperiod_ru],			 [correctionreasoncode],			 [covstatus],			 [curbankaccount_lv],			 [currencycode],			 [custbankaccount_lv],			 [custbankaccountid],			 [custbillingclassification],			 [custgroup],			 [customerref],			 [defaultdimension],			 [fintag],			 [deliverydate_es],			 [deliverypostaladdress],			 [deliverylocation],			 [directdebitmandate],			 [dlvterm],			 [docnumberingcode_lt],			 [documentdate],			 [duedate],			 [einvoiceaccountcode],			 [enterprisenumber],			 [exchrate_w],			 [finecode_br],			 [fiscaladdress_mx],			 [fiscaldocumenttype_br],			 [fiscalestablishment_br],			 [interestcode_br],			 [intrastatfulfillmentdate_hu],			 [invoiceaccount],			 [invoicedate],			 [invoiceid],			 [languageid],			 [log],			 [manualinvoiceid_w],			 [mcrledgervoucher],			 [mcrnumbersequencecode],			 [mcrsalesid],			 [name],			 [numbersequencegroup],			 [numregidtrib_mx],			 [payment],			 [paymentsched],			 [paymmode],			 [paymspec],			 [port],			 [postaladdress],			 [postingprofile],			 [projintercompany],			 [purchorderformnum],			 [releasedate],			 [salesdate_w],			 [salesid],			 [salespurchoperationtype_br],			 [satincotermcode_mx],			 [satpaymmethod_mx],			 [satpurpose_mx],			 [sourcedocumentheader],			 [sourcedocumentline],			 [statprocid],			 [taxgroup],			 [taxitemgroup],			 [taxperiodpaymentcode_pl],			 [tcsgroup_in],			 [transactioncode],			 [transportationdocument],			 [transport],			 [vatduedate_w],			 [vatnum],			 [workersalestaker],			 [orderaccountrefrecid],			 [einvoicecfdiconfirmnumber_mx],			 [externalinvoiceid],			 [customerinvoiceoriginid],			 [vatnumrecid],			 [intentletterid_it],			 [taxid],			 [taxinvoicetransactioncode_id],			 [electronicinvoiceframeworktype_fr],			 [servicecode_fr],			 [projectmanager_fr],			 [servicecoderefrecid],			 [tamdeductionid],			 [tamrebatetransid],			 [rskfxhedgedamount],			 [rskfxfixedexchrate],			 [ecssettlementcontractid],			 [lgslogisticfileid],			 [dctvatfiscalunityid],			 [modifieddatetime],			 [modifiedby],			 [modifiedtransactionid],			 [createddatetime],			 [createdby],			 [createdtransactionid],			 [dataareaid],			 [recversion],			 [partition],			 [sysrowversion],			 [recid],			 [tableid],			 [versionnumber],			 [createdon],			 [modifiedon],			 [IsDelete],			 [mcreasoncode1],			 [mcreasoncode2],			 [mcuuid1],			 [mcuuid2],			 [PartitionId],			 [Ingestion_Timestamp],			 [ODSStartDate],			 [ODSEndDate],			 [ODSActive],			 [ODSHashValue]			) 	  SELECT [Id],			 [SinkCreatedOn],			 [SinkModifiedOn],			 [correct_ru],			 [correctiontype_ru],			 [custfinaluser_br],			 [einvoicelinespec],			 [fiscaldoctype_pl],			 [foreigntrade_mx],			 [forinterestadjustment],			 [girotype],			 [incltax],			 [intercompanyposted],			 [invoicecomplementarytype],			 [listcode],			 [manualnumbering_w],			 [mcrgiftcard],			 [natureofassessee_in],			 [nonrealrevenue_ru],			 [onetimecustomer],			 [posted],			 [postponevat],			 [presencetype_br],			 [printoverduefinetxt_fr],			 [servicecodeondlvaddress_br],			 [sourcecertificate_mx],			 [subledgerjournalstatus],			 [taxwithholdcalculate],			 [touched],			 [unitedvatinvoice_lt],			 [vatonpayment_ru],			 [workflowapprovalstate],			 [workflowapprovalstatus],			 [incltax_w],			 [provisionalassessment_in],			 [withigstpayment_in],			 [wouldyouclaimrefund_in],			 [usedefaultfromcustomer],			 [vatnumtabletype],			 [overridesalestax],			 [excludefromdecoupledpostingprocess],			 [printdynamicqrcode_in],			 [invoicetype_w],			 [cfditemporaryexport_mx],			 [cfdieinvoiceperiod_mx],			 [ecsiscommissioninvoice],			 [sysdatastatecode],			 [tdsgroup_in],			 [orderaccount],			 [accountingdistributiontemplate],			 [adjustinginvoicedate],			 [agreementheaderext_ru],			 [bankaccount_lv],			 [bankcentralbankpurposecode],			 [bankcentralbankpurposetext],			 [cashdiscbasedate],			 [cashdiscbasedays],			 [cashdisccode],			 [cashdiscdate],			 [cashdiscpercent],			 [certificatenumber_mx],			 [cfoptable_br],			 [cfpsid_br],			 [complementedinvoiceid],			 [consigneeaccount_ru],			 [consignoraccount_ru],			 [contactpersonid],			 [correctedfacturedate_ru],			 [correctedfactureexternalid_ru],			 [correctedinvoicedate_ru],			 [correctedinvoiceid_ru],			 [correctedperiod_ru],			 [correctionreasoncode],			 [covstatus],			 [curbankaccount_lv],			 [currencycode],			 [custbankaccount_lv],			 [custbankaccountid],			 [custbillingclassification],			 [custgroup],			 [customerref],			 [defaultdimension],			 [fintag],			 [deliverydate_es],			 [deliverypostaladdress],			 [deliverylocation],			 [directdebitmandate],			 [dlvterm],			 [docnumberingcode_lt],			 [documentdate],			 [duedate],			 [einvoiceaccountcode],			 [enterprisenumber],			 [exchrate_w],			 [finecode_br],			 [fiscaladdress_mx],			 [fiscaldocumenttype_br],			 [fiscalestablishment_br],			 [interestcode_br],			 [intrastatfulfillmentdate_hu],			 [invoiceaccount],			 [invoicedate],			 [invoiceid],			 [languageid],			 [log],			 [manualinvoiceid_w],			 [mcrledgervoucher],			 [mcrnumbersequencecode],			 [mcrsalesid],			 [name],			 [numbersequencegroup],			 [numregidtrib_mx],			 [payment],			 [paymentsched],			 [paymmode],			 [paymspec],			 [port],			 [postaladdress],			 [postingprofile],			 [projintercompany],			 [purchorderformnum],			 [releasedate],			 [salesdate_w],			 [salesid],			 [salespurchoperationtype_br],			 [satincotermcode_mx],			 [satpaymmethod_mx],			 [satpurpose_mx],			 [sourcedocumentheader],			 [sourcedocumentline],			 [statprocid],			 [taxgroup],			 [taxitemgroup],			 [taxperiodpaymentcode_pl],			 [tcsgroup_in],			 [transactioncode],			 [transportationdocument],			 [transport],			 [vatduedate_w],			 [vatnum],			 [workersalestaker],			 [orderaccountrefrecid],			 [einvoicecfdiconfirmnumber_mx],			 [externalinvoiceid],			 [customerinvoiceoriginid],			 [vatnumrecid],			 [intentletterid_it],			 [taxid],			 [taxinvoicetransactioncode_id],			 [electronicinvoiceframeworktype_fr],			 [servicecode_fr],			 [projectmanager_fr],			 [servicecoderefrecid],			 [tamdeductionid],			 [tamrebatetransid],			 [rskfxhedgedamount],			 [rskfxfixedexchrate],			 [ecssettlementcontractid],			 [lgslogisticfileid],			 [dctvatfiscalunityid],			 [modifieddatetime],			 [modifiedby],			 [modifiedtransactionid],			 [createddatetime],			 [createdby],			 [createdtransactionid],			 [dataareaid],			 [recversion],			 [partition],			 [sysrowversion],			 [recid],			 [tableid],			 [versionnumber],			 [createdon],			 [modifiedon],			 [IsDelete],			 [mcreasoncode1],			 [mcreasoncode2],			 [mcuuid1],			 [mcuuid2],			 [PartitionId],			 [Ingestion_Timestamp],			 GETUTCDATE(),			 CONVERT(DATETIME, '31-12-9999', 103),			 CONVERT(BIT, 1),			 [ODSHashValue] 		FROM [21D365_stg].[custinvoicetable] WHERE [ODSRecordStatus] IN ('C', 'N');					   
				
/*
 ************************************************************************************************************
 *	End of creating the stored procedure.																	*
 ************************************************************************************************************
*/

END

GO

