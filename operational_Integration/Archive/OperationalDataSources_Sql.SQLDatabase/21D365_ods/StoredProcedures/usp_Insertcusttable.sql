
/*
 ************************************************************************************************************
 *	Create Stored Procedure.																				*
 ************************************************************************************************************
*/

CREATE PROCEDURE [21D365_ods].[usp_Insertcusttable]

AS

BEGIN

	/*
	 ********************************************************************************************************
	 *	Update the ODSHashValue Field in the Staging table with the Hash value of the record.				*
	 ********************************************************************************************************
	*/

	UPDATE A
	   SET [ODSHashValue] = CAST(HASHBYTES('MD5', ISNULL(SUBSTRING([Id], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([SinkCreatedOn] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL(CAST([SinkModifiedOn] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL([accountstatement], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([affiliated_ru], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([blocked], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([companytype_mx], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([creditcardaddressverification], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([creditcardaddressverificationlevel], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([creditcardaddressverificationvoid], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([creditcardcvc], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([custexcludecollectionfee], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([custexcludeinterestcharges], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([custfinaluser_br], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([custwhtcontributiontype_br], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([einvoice], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([einvoiceattachment], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([entrycertificaterequired_w], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([exportsales_pl], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([expressbilloflading], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([fednonfedindicator], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([fiscaldoctype_pl], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([forecastdmpinclude], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([foreignresident_ru], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([generateincomingfiscaldocument_br], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([girotype], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([girotypeaccountstatement], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([girotypecollectionletter], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([girotypefreetextinvoice], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([girotypeinterestnote], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([girotypeprojinvoice], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([icmscontributor_br], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([incltax], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([intercompanyallowindirectcreation], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([intercompanyautocreateorders], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([intercompanydirectdelivery], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([inventprofiletype_ru], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([invoiceaddress], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([invoicepostingtype_ru], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([irs1099cindicator], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([isresident_lv], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([issueownentrycertificate_w], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([mandatorycreditlimit], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([mandatoryvatdate_pl], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([onetimecustomer], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([packagedepositexcempt_pl], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([pdsfreightaccrued], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([rfidcasetagging], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([rfiditemtagging], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([rfidpallettagging], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([servicecodeondlvaddress_br], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([shipcarrierblindshipment], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([shipcarrierfuelsurcharge], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([suframa_br], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([suframapiscofins_br], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([taxwithholdcalculate_in], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([taxwithholdcalculate_th], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([unitedvatinvoice_lt], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([usecashdisc], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([usepurchrequest], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([websalesorderdisplay], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([einvoiceregister_it], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([presencetype_br], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([isexternallymaintained], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([cfdienabled_mx], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([foreigntrade_mx], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([workflowstate], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([useoriginaldocumentasfacture_ru], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([collectionlettercode], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([blockfloorlimituseinchannel], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([cfdiskipiepstaxes_mx], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([simplifytaxintgrexportdocvalidation_cn], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([simplenational_br], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([vatnumtabletype], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([overridesalestax], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([usualexporter_it], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([ispublicsector_it], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([simplifytaxintgrexporttaxregvalidation_cn], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([printdynamicqrcode_in], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([invoicetype_w], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([cfditemporaryexport_mx], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([credmanexclude], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([credmantitleheld], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([credmanwithagency], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([credmancustunlimitedcredit], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([avaabifactoringselected], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([revrecdisableintercompany], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([sysdatastatecode], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([paymtermid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([linedisc], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([taxwithholdgroup_th], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([partycountry], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([accountnum], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([agencylocationcode], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([bankaccount], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([bankcentralbankpurposecode], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([bankcentralbankpurposetext], 1, 255), '') + '|' + 							CAST(ISNULL([bankcustpaymidtable], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([birthcountycode_it], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([birthplace_it], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([cashdisc], 1, 255), '') + '|' + 							CAST(ISNULL([cashdiscbasedays], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([ccmnum_br], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([clearingperiod], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([cnae_br], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([cnpjcpfnum_br], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([commercialregister], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([commercialregisterinsetnumber], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([commercialregistersection], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([commissiongroup], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([companychainid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([companyidsiret], 1, 255), '') + '|' + 							CAST(ISNULL([companynafcode], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([consday_jp], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([contactpersonid], 1, 255), '') + '|' + 							CAST(ISNULL([creditmax], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([creditrating], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([curp_mx], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([currency], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([custclassificationid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([custgroup], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([custitemgroupid], 1, 255), '') + '|' + 							CAST(ISNULL([custtradingpartnercode], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([defaultdimension], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([defaultdirectdebitmandate], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([defaultinventstatusid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([destinationcodeid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([dlvmode], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([dlvreason], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([dlvterm], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([einvoiceeannum], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([enddisc], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([enterprisenumber], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([factoringaccount], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([federalcomments], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([finecode_br], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([fiscalcode], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([freightzone], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([identificationnumber], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([ienum_br], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([insscei_br], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([intbank_lv], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([interestcode_br], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([inventlocation], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([inventprofileid_ru], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([inventsiteid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([invoiceaccount], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([issuercountry_hu], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([lineofbusinessid], 1, 255), '') + '|' + 							CAST(ISNULL([lvpaymtranscodes], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([maincontactworker], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([markupgroup], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([mcrmergedparent], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([mcrmergedroot], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([memo], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([multilinedisc], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([nit_br], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([numbersequencegroup], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([orderentrydeadlinegroupid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([orgid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([ouraccountnum], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([packmaterialfeelicensenum], 1, 255), '') + '|' + 							CAST(ISNULL([party], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([partystate], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([passportno_hu], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([paymdayid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([paymentreference_ee], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([paymidtype], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([paymmode], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([paymsched], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([paymspec], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([pdscustrebategroupid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([pdsrebatetmagroup], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([pricegroup], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([residenceforeigncountryregionid_it], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([rfc_mx], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([salescalendarid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([salesdistrictid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([salesgroup], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([salespoolid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([segmentid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([shipcarrieraccount], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([shipcarrieraccountcode], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([shipcarrierid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([stateinscription_mx], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([statisticsgroup], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([subsegmentid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([suframanumber_br], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([suppitemgroupid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([taxgroup], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([taxlicensenum], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([taxperiodpaymentcode_pl], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([vatnum], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([vendaccount], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([authorityoffice_it], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([foreignerid_br], 1, 255), '') + '|' + 							CAST(ISNULL([taxgstreliefgroupheading_my], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([foreigntaxregistration_mx], 1, 255), '') + '|' + 							CAST(ISNULL([custwriteoffrefrecid], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([regnum_w], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([enterprisecode], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([taxbordernumber_fi], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([birthdate_it] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([satpaymmethod_mx], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([satpurpose_mx], 1, 255), '') + '|' + 							CAST(ISNULL([vatnumrecid], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([freenotesgroup_it], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([taxregimecode_mx], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([satregistrationname_mx], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([credmaneligiblecreditlimitdate] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([credmangroupid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([credmannotes], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([credmanaccountstatusid], 1, 255), '') + '|' + 							CAST(ISNULL([credmaneligiblecreditmax], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL(CAST([credmanbusinessstarted] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL([credmancustcreditmaxalt], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([credmaneligiblecreditlimitcurrency], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([credmancustomersince] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([credmanstatusreasonid], 1, 255), '') + '|' + 							ISNULL(SUBSTRING([credmancollectiongroupid], 1, 255), '') + '|' + 							CAST(ISNULL(CAST([credmancreditlimitexpirydate] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL(CAST([credmancreditlimitdate] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL(CAST([credmanlastreviewdate] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL(CAST([credmannextschedreviewdate] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([avaabinamealias], 1, 255), '') + '|' + 							CAST(ISNULL([dctcreditlimitprojectiontimefence], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([ccspurchfinancingpercent], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([ccssalesfinancingpercent], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL(CAST([modifieddatetime] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([modifiedby], 1, 255), '') + '|' + 							CAST(ISNULL([modifiedtransactionid], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL(CAST([createddatetime] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							ISNULL(SUBSTRING([createdby], 1, 255), '') + '|' + 							CAST(ISNULL([createdtransactionid], 0) AS NVARCHAR(50)) + '|' + 							ISNULL(SUBSTRING([dataareaid], 1, 255), '') + '|' + 							CAST(ISNULL([recversion], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([partition], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([sysrowversion], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([recid], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([tableid], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL([versionnumber], 0) AS NVARCHAR(50)) + '|' + 							CAST(ISNULL(CAST([createdon] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL(CAST([modifiedon] AS DATETIME2(6)), CAST('1901-01-01' AS DATETIME2(6))) AS NVARCHAR(26)) + '|' + 							CAST(ISNULL([IsDelete], 0) AS NVARCHAR(50)) + '|' + 							ISNULL([PartitionId], '') + '|' + 							ISNULL(SUBSTRING([mcfiscallegends_mx], 1, 255), '')) AS BINARY(16))
	  FROM [21D365_stg].[custtable] A; 

							 
	/*
	 ********************************************************************************************************
	 *	If the Destination table has no records update the Staging table Record Source with the value (N)ew.*
	 ********************************************************************************************************
	*/

	IF NOT EXISTS (SELECT count(*) FROM [21D365_ods].[custtable] HAVING count(*) > 0)
	BEGIN
	    UPDATE [21D365_stg].[custtable]
		   SET [ODSRecordStatus] = 'N'
		 WHERE [ODSRecordStatus] IS NULL
	END;

	/*
	 ********************************************************************************************************
	 *	If the Destination table is not empty Update the ODSRecordStatus with values (N), (C) or (S).		*
	 ********************************************************************************************************
	*/

	IF EXISTS (SELECT count(*) FROM [21D365_ods].[custtable] HAVING count(*) > 0)
	BEGIN

		UPDATE A
		   SET A.[ODSRecordStatus] = 'N'
		  FROM [21D365_stg].[custtable] A LEFT JOIN [21D365_ods].[custtable] B
		    ON A.[recid] = B.[recid]
		 WHERE B.[recid] IS NULL

		UPDATE A
		   SET A.[ODSRecordStatus] = 'C'
		  FROM [21D365_stg].[custtable] A INNER JOIN [21D365_ods].[custtable] B
		    ON A.[recid] = B.[recid]
		   AND A.[ODSHashValue] <> B.[ODSHashValue]

		UPDATE A
		   SET A.[ODSRecordStatus] = 'S'
		  FROM [21D365_stg].[custtable] A INNER JOIN [21D365_ods].[custtable] B
		    ON A.[recid] = B.[recid]
		   AND A.[ODSHashValue] = B.[ODSHashValue]
	END;				
	/*
	 ********************************************************************************************************
	 *	Update ODS Fields if table Exists.																	*
	 ********************************************************************************************************
	*/

	UPDATE A
	   SET A.[ODSEndDate] = GETDATE(),
		   A.[ODSActive] = CONVERT(BIT, 0)
	  FROM [21D365_ods].[custtable] A INNER JOIN [21D365_stg].[custtable] B
	    ON A.[recid] = B.[recid]
	 WHERE B.[ODSRecordStatus] = 'C'
	   AND A.[ODSEndDate] = CONVERT(DATETIME, '31-12-9999', 103)
	   AND A.[ODSActive] = CONVERT(BIT, 1); 
	
	/*
	 ********************************************************************************************************
	 *	Insert New And Changed records in the ODS Table.													*
	 ********************************************************************************************************
	*/

	INSERT INTO [21D365_ods].[custtable]			(			 [Id],			 [SinkCreatedOn],			 [SinkModifiedOn],			 [accountstatement],			 [affiliated_ru],			 [blocked],			 [companytype_mx],			 [creditcardaddressverification],			 [creditcardaddressverificationlevel],			 [creditcardaddressverificationvoid],			 [creditcardcvc],			 [custexcludecollectionfee],			 [custexcludeinterestcharges],			 [custfinaluser_br],			 [custwhtcontributiontype_br],			 [einvoice],			 [einvoiceattachment],			 [entrycertificaterequired_w],			 [exportsales_pl],			 [expressbilloflading],			 [fednonfedindicator],			 [fiscaldoctype_pl],			 [forecastdmpinclude],			 [foreignresident_ru],			 [generateincomingfiscaldocument_br],			 [girotype],			 [girotypeaccountstatement],			 [girotypecollectionletter],			 [girotypefreetextinvoice],			 [girotypeinterestnote],			 [girotypeprojinvoice],			 [icmscontributor_br],			 [incltax],			 [intercompanyallowindirectcreation],			 [intercompanyautocreateorders],			 [intercompanydirectdelivery],			 [inventprofiletype_ru],			 [invoiceaddress],			 [invoicepostingtype_ru],			 [irs1099cindicator],			 [isresident_lv],			 [issueownentrycertificate_w],			 [mandatorycreditlimit],			 [mandatoryvatdate_pl],			 [onetimecustomer],			 [packagedepositexcempt_pl],			 [pdsfreightaccrued],			 [rfidcasetagging],			 [rfiditemtagging],			 [rfidpallettagging],			 [servicecodeondlvaddress_br],			 [shipcarrierblindshipment],			 [shipcarrierfuelsurcharge],			 [suframa_br],			 [suframapiscofins_br],			 [taxwithholdcalculate_in],			 [taxwithholdcalculate_th],			 [unitedvatinvoice_lt],			 [usecashdisc],			 [usepurchrequest],			 [websalesorderdisplay],			 [einvoiceregister_it],			 [presencetype_br],			 [isexternallymaintained],			 [cfdienabled_mx],			 [foreigntrade_mx],			 [workflowstate],			 [useoriginaldocumentasfacture_ru],			 [collectionlettercode],			 [blockfloorlimituseinchannel],			 [cfdiskipiepstaxes_mx],			 [simplifytaxintgrexportdocvalidation_cn],			 [simplenational_br],			 [vatnumtabletype],			 [overridesalestax],			 [usualexporter_it],			 [ispublicsector_it],			 [simplifytaxintgrexporttaxregvalidation_cn],			 [printdynamicqrcode_in],			 [invoicetype_w],			 [cfditemporaryexport_mx],			 [credmanexclude],			 [credmantitleheld],			 [credmanwithagency],			 [credmancustunlimitedcredit],			 [avaabifactoringselected],			 [revrecdisableintercompany],			 [sysdatastatecode],			 [paymtermid],			 [linedisc],			 [taxwithholdgroup_th],			 [partycountry],			 [accountnum],			 [agencylocationcode],			 [bankaccount],			 [bankcentralbankpurposecode],			 [bankcentralbankpurposetext],			 [bankcustpaymidtable],			 [birthcountycode_it],			 [birthplace_it],			 [cashdisc],			 [cashdiscbasedays],			 [ccmnum_br],			 [clearingperiod],			 [cnae_br],			 [cnpjcpfnum_br],			 [commercialregister],			 [commercialregisterinsetnumber],			 [commercialregistersection],			 [commissiongroup],			 [companychainid],			 [companyidsiret],			 [companynafcode],			 [consday_jp],			 [contactpersonid],			 [creditmax],			 [creditrating],			 [curp_mx],			 [currency],			 [custclassificationid],			 [custgroup],			 [custitemgroupid],			 [custtradingpartnercode],			 [defaultdimension],			 [defaultdirectdebitmandate],			 [defaultinventstatusid],			 [destinationcodeid],			 [dlvmode],			 [dlvreason],			 [dlvterm],			 [einvoiceeannum],			 [enddisc],			 [enterprisenumber],			 [factoringaccount],			 [federalcomments],			 [finecode_br],			 [fiscalcode],			 [freightzone],			 [identificationnumber],			 [ienum_br],			 [insscei_br],			 [intbank_lv],			 [interestcode_br],			 [inventlocation],			 [inventprofileid_ru],			 [inventsiteid],			 [invoiceaccount],			 [issuercountry_hu],			 [lineofbusinessid],			 [lvpaymtranscodes],			 [maincontactworker],			 [markupgroup],			 [mcrmergedparent],			 [mcrmergedroot],			 [memo],			 [multilinedisc],			 [nit_br],			 [numbersequencegroup],			 [orderentrydeadlinegroupid],			 [orgid],			 [ouraccountnum],			 [packmaterialfeelicensenum],			 [party],			 [partystate],			 [passportno_hu],			 [paymdayid],			 [paymentreference_ee],			 [paymidtype],			 [paymmode],			 [paymsched],			 [paymspec],			 [pdscustrebategroupid],			 [pdsrebatetmagroup],			 [pricegroup],			 [residenceforeigncountryregionid_it],			 [rfc_mx],			 [salescalendarid],			 [salesdistrictid],			 [salesgroup],			 [salespoolid],			 [segmentid],			 [shipcarrieraccount],			 [shipcarrieraccountcode],			 [shipcarrierid],			 [stateinscription_mx],			 [statisticsgroup],			 [subsegmentid],			 [suframanumber_br],			 [suppitemgroupid],			 [taxgroup],			 [taxlicensenum],			 [taxperiodpaymentcode_pl],			 [vatnum],			 [vendaccount],			 [authorityoffice_it],			 [foreignerid_br],			 [taxgstreliefgroupheading_my],			 [foreigntaxregistration_mx],			 [custwriteoffrefrecid],			 [regnum_w],			 [enterprisecode],			 [taxbordernumber_fi],			 [birthdate_it],			 [satpaymmethod_mx],			 [satpurpose_mx],			 [vatnumrecid],			 [freenotesgroup_it],			 [taxregimecode_mx],			 [satregistrationname_mx],			 [credmaneligiblecreditlimitdate],			 [credmangroupid],			 [credmannotes],			 [credmanaccountstatusid],			 [credmaneligiblecreditmax],			 [credmanbusinessstarted],			 [credmancustcreditmaxalt],			 [credmaneligiblecreditlimitcurrency],			 [credmancustomersince],			 [credmanstatusreasonid],			 [credmancollectiongroupid],			 [credmancreditlimitexpirydate],			 [credmancreditlimitdate],			 [credmanlastreviewdate],			 [credmannextschedreviewdate],			 [avaabinamealias],			 [dctcreditlimitprojectiontimefence],			 [ccspurchfinancingpercent],			 [ccssalesfinancingpercent],			 [modifieddatetime],			 [modifiedby],			 [modifiedtransactionid],			 [createddatetime],			 [createdby],			 [createdtransactionid],			 [dataareaid],			 [recversion],			 [partition],			 [sysrowversion],			 [recid],			 [tableid],			 [versionnumber],			 [createdon],			 [modifiedon],			 [IsDelete],			 [PartitionId],			 [mcfiscallegends_mx],			 [ODSStartDate],			 [ODSEndDate],			 [ODSActive],			 [ODSHashValue]			) 	  SELECT [Id],			 [SinkCreatedOn],			 [SinkModifiedOn],			 [accountstatement],			 [affiliated_ru],			 [blocked],			 [companytype_mx],			 [creditcardaddressverification],			 [creditcardaddressverificationlevel],			 [creditcardaddressverificationvoid],			 [creditcardcvc],			 [custexcludecollectionfee],			 [custexcludeinterestcharges],			 [custfinaluser_br],			 [custwhtcontributiontype_br],			 [einvoice],			 [einvoiceattachment],			 [entrycertificaterequired_w],			 [exportsales_pl],			 [expressbilloflading],			 [fednonfedindicator],			 [fiscaldoctype_pl],			 [forecastdmpinclude],			 [foreignresident_ru],			 [generateincomingfiscaldocument_br],			 [girotype],			 [girotypeaccountstatement],			 [girotypecollectionletter],			 [girotypefreetextinvoice],			 [girotypeinterestnote],			 [girotypeprojinvoice],			 [icmscontributor_br],			 [incltax],			 [intercompanyallowindirectcreation],			 [intercompanyautocreateorders],			 [intercompanydirectdelivery],			 [inventprofiletype_ru],			 [invoiceaddress],			 [invoicepostingtype_ru],			 [irs1099cindicator],			 [isresident_lv],			 [issueownentrycertificate_w],			 [mandatorycreditlimit],			 [mandatoryvatdate_pl],			 [onetimecustomer],			 [packagedepositexcempt_pl],			 [pdsfreightaccrued],			 [rfidcasetagging],			 [rfiditemtagging],			 [rfidpallettagging],			 [servicecodeondlvaddress_br],			 [shipcarrierblindshipment],			 [shipcarrierfuelsurcharge],			 [suframa_br],			 [suframapiscofins_br],			 [taxwithholdcalculate_in],			 [taxwithholdcalculate_th],			 [unitedvatinvoice_lt],			 [usecashdisc],			 [usepurchrequest],			 [websalesorderdisplay],			 [einvoiceregister_it],			 [presencetype_br],			 [isexternallymaintained],			 [cfdienabled_mx],			 [foreigntrade_mx],			 [workflowstate],			 [useoriginaldocumentasfacture_ru],			 [collectionlettercode],			 [blockfloorlimituseinchannel],			 [cfdiskipiepstaxes_mx],			 [simplifytaxintgrexportdocvalidation_cn],			 [simplenational_br],			 [vatnumtabletype],			 [overridesalestax],			 [usualexporter_it],			 [ispublicsector_it],			 [simplifytaxintgrexporttaxregvalidation_cn],			 [printdynamicqrcode_in],			 [invoicetype_w],			 [cfditemporaryexport_mx],			 [credmanexclude],			 [credmantitleheld],			 [credmanwithagency],			 [credmancustunlimitedcredit],			 [avaabifactoringselected],			 [revrecdisableintercompany],			 [sysdatastatecode],			 [paymtermid],			 [linedisc],			 [taxwithholdgroup_th],			 [partycountry],			 [accountnum],			 [agencylocationcode],			 [bankaccount],			 [bankcentralbankpurposecode],			 [bankcentralbankpurposetext],			 [bankcustpaymidtable],			 [birthcountycode_it],			 [birthplace_it],			 [cashdisc],			 [cashdiscbasedays],			 [ccmnum_br],			 [clearingperiod],			 [cnae_br],			 [cnpjcpfnum_br],			 [commercialregister],			 [commercialregisterinsetnumber],			 [commercialregistersection],			 [commissiongroup],			 [companychainid],			 [companyidsiret],			 [companynafcode],			 [consday_jp],			 [contactpersonid],			 [creditmax],			 [creditrating],			 [curp_mx],			 [currency],			 [custclassificationid],			 [custgroup],			 [custitemgroupid],			 [custtradingpartnercode],			 [defaultdimension],			 [defaultdirectdebitmandate],			 [defaultinventstatusid],			 [destinationcodeid],			 [dlvmode],			 [dlvreason],			 [dlvterm],			 [einvoiceeannum],			 [enddisc],			 [enterprisenumber],			 [factoringaccount],			 [federalcomments],			 [finecode_br],			 [fiscalcode],			 [freightzone],			 [identificationnumber],			 [ienum_br],			 [insscei_br],			 [intbank_lv],			 [interestcode_br],			 [inventlocation],			 [inventprofileid_ru],			 [inventsiteid],			 [invoiceaccount],			 [issuercountry_hu],			 [lineofbusinessid],			 [lvpaymtranscodes],			 [maincontactworker],			 [markupgroup],			 [mcrmergedparent],			 [mcrmergedroot],			 [memo],			 [multilinedisc],			 [nit_br],			 [numbersequencegroup],			 [orderentrydeadlinegroupid],			 [orgid],			 [ouraccountnum],			 [packmaterialfeelicensenum],			 [party],			 [partystate],			 [passportno_hu],			 [paymdayid],			 [paymentreference_ee],			 [paymidtype],			 [paymmode],			 [paymsched],			 [paymspec],			 [pdscustrebategroupid],			 [pdsrebatetmagroup],			 [pricegroup],			 [residenceforeigncountryregionid_it],			 [rfc_mx],			 [salescalendarid],			 [salesdistrictid],			 [salesgroup],			 [salespoolid],			 [segmentid],			 [shipcarrieraccount],			 [shipcarrieraccountcode],			 [shipcarrierid],			 [stateinscription_mx],			 [statisticsgroup],			 [subsegmentid],			 [suframanumber_br],			 [suppitemgroupid],			 [taxgroup],			 [taxlicensenum],			 [taxperiodpaymentcode_pl],			 [vatnum],			 [vendaccount],			 [authorityoffice_it],			 [foreignerid_br],			 [taxgstreliefgroupheading_my],			 [foreigntaxregistration_mx],			 [custwriteoffrefrecid],			 [regnum_w],			 [enterprisecode],			 [taxbordernumber_fi],			 [birthdate_it],			 [satpaymmethod_mx],			 [satpurpose_mx],			 [vatnumrecid],			 [freenotesgroup_it],			 [taxregimecode_mx],			 [satregistrationname_mx],			 [credmaneligiblecreditlimitdate],			 [credmangroupid],			 [credmannotes],			 [credmanaccountstatusid],			 [credmaneligiblecreditmax],			 [credmanbusinessstarted],			 [credmancustcreditmaxalt],			 [credmaneligiblecreditlimitcurrency],			 [credmancustomersince],			 [credmanstatusreasonid],			 [credmancollectiongroupid],			 [credmancreditlimitexpirydate],			 [credmancreditlimitdate],			 [credmanlastreviewdate],			 [credmannextschedreviewdate],			 [avaabinamealias],			 [dctcreditlimitprojectiontimefence],			 [ccspurchfinancingpercent],			 [ccssalesfinancingpercent],			 [modifieddatetime],			 [modifiedby],			 [modifiedtransactionid],			 [createddatetime],			 [createdby],			 [createdtransactionid],			 [dataareaid],			 [recversion],			 [partition],			 [sysrowversion],			 [recid],			 [tableid],			 [versionnumber],			 [createdon],			 [modifiedon],			 [IsDelete],			 [PartitionId],			 [mcfiscallegends_mx],			 GETUTCDATE(),			 CONVERT(DATETIME, '31-12-9999', 103),			 CONVERT(BIT, 1),			 [ODSHashValue] 		FROM [21D365_stg].[custtable] WHERE [ODSRecordStatus] IN ('C', 'N');					   
				
/*
 ************************************************************************************************************
 *	End of creating the stored procedure.																	*
 ************************************************************************************************************
*/

END

GO

