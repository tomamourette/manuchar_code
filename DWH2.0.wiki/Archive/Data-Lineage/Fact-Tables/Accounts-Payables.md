---
# Accounts Payables(AP) Mapping
---

## Introduction

Accounts Payables (AP) is based on a SQL View in DWH called **dbo.Accounts Payables** which will be the _Target_ and it is derived from **dwh.Fact_AccountsPayable** will be the _Source_.
The view is generated by creating 3 tables of **dwh.Fact_AccountsPayable** with different Currency Type Key (1, 2, 3) and combining these 3 tables by using union all. Each table generated has joins with these tables:
- dwh.Sec_KeyCombinations;
- dwh.Dim_Currency;
- dwh.Dim_Date;

---

## Data Lineage

::: mermaid
 graph LR;
 A[dwh.Fact_AccountsPayable with Currency Type Key 1] --> B[dbo.Accounts Payables] -->  C[Accounts Payables];
D[dwh.Fact_AccountsPayable with Currency Type Key 2] -->  B;
E[dwh.Fact_AccountsPayable with Currency Type Key 3] -->  B;
:::

---

## Source Details 

Source Name: `dwh.Fact_AccountsPayable` 
Source Type: `Table`
Source System: `DWH SQL Server`


|Table Name| Column Name| Data Type  |  Nullable | Description   |
|--|--|--|--|--|
|dwh.Fact_AccountsPayable|  InvoiceCode|  nvarchar(1000) | True||
|dwh.Fact_AccountsPayable|  uk_field|   nvarchar(1104)| False ||
|dwh.Fact_AccountsPayable|  FK_Company|  bigint | True  ||
|dwh.Fact_AccountsPayable|  FK_ClosingDate |  int | True  ||
|dwh.Fact_AccountsPayable|  FK_InvoiceDate|  int | True  ||
|dwh.Fact_AccountsPayable|  FK_DueDate|  int | True  ||
|dwh.Fact_AccountsPayable|  FK_AgeGroup|  bigint | True  ||
|dwh.Fact_AccountsPayable|  FK_BusinessType|  bigint | True  ||
|dwh.Fact_AccountsPayable|  FK_HomeCurrency|bigint   | True  ||
|dwh.Fact_AccountsPayable|  FK_InvoiceCurrency|  bigint | True  ||
|dwh.Fact_AccountsPayable|  FK_BusinessPartner|  bigint | True  ||
|dwh.Fact_AccountsPayable|  OriginalInvoiceCode|  nvarchar(1000)| True  ||
|dwh.Fact_AccountsPayable|  PaymentTerm|  nvarchar(1000) | True||
|dwh.Fact_AccountsPayable|  Filename|  nvarchar(500) | True||
|dwh.Fact_AccountsPayable|  InvoiceAmountInvoiceCurrency|  decimal(38, 6)| True||
|dwh.Fact_AccountsPayable|  InvoiceAmountHomeCurrency|  decimal(38, 6)| True||
|dwh.Fact_AccountsPayable|  InvoiceAmountGroupCurrency|  decimal(18, 2)| True||
|dwh.Fact_AccountsPayable|  OpenAmountInvoiceCurrency|  decimal(38, 6)| True||
|dwh.Fact_AccountsPayable|  OpenAmountHomeCurrency|  decimal(38,6) | True||
|dwh.Fact_AccountsPayable|  OpenAmountGroupCurrency|  decimal(18,2) | True||
|dwh.Fact_AccountsPayable|  KDP_checksum|  int | True  ||
|dwh.Fact_AccountsPayable|  KDP_executionId|  int | True  ||
|dwh.Fact_AccountsPayable|  KDP_loadDT|  datetime| True  ||

---

Source Name: `dwh.Sec_KeyCombinations`
Source Type: `Table`
Source System: `DWH SQL Server`


|Table Name| Column Name| Data Type  |  Nullable | Description   |
|--|--|--|--|--|
|dwh.Sec_KeyCombinations|  KDP_SK|  bigint IDENTITY(1,1) | False||
|dwh.Sec_KeyCombinations|  FK_BusinessType|  bigint | False||
|dwh.Sec_KeyCombinations|  FK_BusinessUnit|  bigint | False||
|dwh.Sec_KeyCombinations|  FK_CustomerCountry|  bigint| False||
|dwh.Sec_KeyCombinations|  FK_Company|  bigint| False||

---
Source Name: `dwh.Dim_Currency`
Source Type: `Table`
Source System: `DWH SQL Server`

|Table Name| Column Name| Data Type  |  Nullable | Description   |
|--|--|--|--|--|
|dwh.Dim_Currency|  CurrencyCode|  nvarchar(20) | True  ||
|dwh.Dim_Currency|  IsActive|  bit | True  ||
|dwh.Dim_Currency|  Currency|  nvarchar(500) | True  ||
|dwh.Dim_Currency|  KDP_SK|  bigint IDENTITY(1,1) | False||
|dwh.Dim_Currency|  KDP_checksum|  int | True  ||
|dwh.Dim_Currency|  KDP_executionId|  int | True  ||
|dwh.Dim_Currency|  KDP_loadDT|  datetime | True  ||

---


Source Name: `dwh.Dim_Date`
Source Type: `Table` 
Source System: `DWH SQL Server`


|Table Name| Column Name| Data Type  |  Nullable | Description   |
|--|--|--|--|--|
|dwh.Dim_Date|  DateId|  char(30) | False||
|dwh.Dim_Date|  DateFull|  date| True  ||
|dwh.Dim_Date|  DayName|  varchar(9)| True  ||
|dwh.Dim_Date|  DayInWeek|  int | True  ||
|dwh.Dim_Date|  DayInMonth|  int | True  ||
|dwh.Dim_Date|  DayInYear|  int | True  ||
|dwh.Dim_Date|  WeekCode|  varchar(14)| True  ||
|dwh.Dim_Date|  WeekInYear|  int | True  ||
|dwh.Dim_Date|  FirstDayInWeek|  date| True  ||
|dwh.Dim_Date|  LastDayInWeek|  date| True  ||
|dwh.Dim_Date|  MonthCode|  varchar(14)| True  ||
|dwh.Dim_Date|  MonthName|  varchar(9)| True  ||
|dwh.Dim_Date|  MonthInYear|  int | True  ||
|dwh.Dim_Date|  FirstDayInMonth|  date| True  ||
|dwh.Dim_Date|  LastDayInMonth|  date| True  ||
|dwh.Dim_Date|  QuarterCode|  varchar(14)| True  ||
|dwh.Dim_Date|  QuarterFull|  varchar(15)| True  ||
|dwh.Dim_Date|  QuarterInYear|  int | True  ||
|dwh.Dim_Date|  FirstDayInQuarter|  date| True  ||
|dwh.Dim_Date|  LastDayInQuarter|  date| True  ||
|dwh.Dim_Date|  Year|  int | True  ||
|dwh.Dim_Date|  FirstDayInYear|  date| True  ||
|dwh.Dim_Date|  LastDayInYear|  date| True  ||
|dwh.Dim_Date|  KDP_SK|  char(30)| False||
|dwh.Dim_Date|  KDP_checksum|  int | True  ||
|dwh.Dim_Date|  KDP_executionId|  int | True  ||
|dwh.Dim_Date|  KDP_loadDT|  datetime | True  ||




---

## Target Details
Target Name: `dbo.Accounts Payables`
Target Type: `View`
Target System: `DWH SQL Server`

|View Name| Column Name| Data Type  |  Nullable | Description   |
|--|--|--|--|--|
|dbo.Accounts Payables |  Currency Type Key |  | ||
|dbo.Accounts Payables |  Currency Key |  bigint IDENTITY(1,1)| False||
|dbo.Accounts Payables |  Company Key |  bigint| True||
|dbo.Accounts Payables |  Date Closing Key|  int| True||
|dbo.Accounts Payables |  Business Partner Key |  bigint | True||
|dbo.Accounts Payables |  Age Group Key |  bigint | True||
|dbo.Accounts Payables |  Business Type Key |  bigint | True||
|dbo.Accounts Payables |  Date Invoice |  date| True||
|dbo.Accounts Payables |  Date Due|  date| True||
|dbo.Accounts Payables |  Payment Term|  nvarchar(1000)| True||
|dbo.Accounts Payables |  AP Invoice ID|  nvarchar(1000)| True||
|dbo.Accounts Payables |  AP Invoice Number|  nvarchar(1000)| True||
|dbo.Accounts Payables |  M AP Invoice Amount|  decimal(18, 2)| True||
|dbo.Accounts Payables | M AP Balance Amount|  decimal(18, 2)| True||
|dbo.Accounts Payables |M AP Overdue Amount|  | ||
|dbo.Accounts Payables |M AP Overdue > 360 Days Amount|  | ||
|dbo.Accounts Payables |M AP Days To Due Date|  | ||
|dbo.Accounts Payables |M AP Days Over Due Date|  | ||
|dbo.Accounts Payables |Security Key|  | ||
|dbo.Accounts Payables |KeyCombination Key| bigint IDENTITY(1,1) | false ||

---
## 1st AP table: Currency Type Key Set to 2

### Field Mapping


| Source Table | Source Field  | Target Table  | Target Field  | Transformation Rules  | Data Type | Nullable  |
|--|--|--|--|--|--|--|
| | |dbo.Accounts Payables |  Currency Type Key | Set to 2 | |  |
| dwh.Dim_Currency| KDP_SK|dbo.Accounts Payables |  Currency Key | None | bigint   |  False|
| dwh.Fact_AccountsPayable| FK_Company|dbo.Accounts Payables |  Company Key | None | bigint   |  True|
| dwh.Fact_AccountsPayable| FK_ClosingDate|dbo.Accounts Payables |  Date Closing Key | None | int|  True|
| dwh.Fact_AccountsPayable| FK_BusinessPartner|dbo.Accounts Payables | Business Partner Key | None | bigint   |  True|
| dwh.Fact_AccountsPayable| FK_AgeGroup|dbo.Accounts Payables | Age Group  Key | None | bigint   |  True|
| dwh.Fact_AccountsPayable| FK_BusinessType|dbo.Accounts Payables | Business Type Key | None | bigint   |  True|
| dwh.Dim_Date id| DateFull|dbo.Accounts Payables | Date Invoice| None | date|  True|
| dwh.Dim_Date dd| DateFull|dbo.Accounts Payables | Date Due| None | date|  True|
| dwh.Fact_AccountsPayable| PaymentTerm|dbo.Accounts Payables | Payment Term| None | nvarchar(1000)|  True|
| dwh.Fact_AccountsPayable| InvoiceCode|dbo.Accounts Payables |AP Invoice ID| None | nvarchar(1000)|  True|
| dwh.Fact_AccountsPayable| OriginalInvoiceCode|dbo.Accounts Payables |AP Invoice Number| None | nvarchar(1000)|  True|
| dwh.Fact_AccountsPayable| InvoiceAmountGroupCurrency|dbo.Accounts Payables |M AP Invoice Amount| None | decimal(18, 2)|  True|
| dwh.Fact_AccountsPayable| OpenAmountGroupCurrency|dbo.Accounts Payables |M AP Balance Amount| None | decimal(18, 2)|  True|
| dwh.Fact_AccountsPayable| FK_DueDate, FK_ClosingDate, OpenAmountGroupCurrency|dbo.Accounts Payables |M AP Overdue Amount| WHEN FK_DueDate < FK_ClosingDate THEN OpenAmountGroupCurrency ELSE 0.00||  |
| dwh.Fact_AccountsPayable ap, dwh.Dim_Date dd, dwh.Dim_Date cd|  dd.[DateFull], cd.[DateFull], ap.[OpenAmountGroupCurrency]|dbo.Accounts Payables |M AP Overdue > 360 Days Amount| WHEN DATEDIFF(YEAR, dd.[DateFull], cd.[DateFull]) > 0 THEN ap.[OpenAmountGroupCurrency] ELSE 0.00| |  |
| dwh.Dim_Date cd, dwh.Dim_Date dd|  cd.[DateFull], dd.[DateFull] |dbo.Accounts Payables |M AP Days To Due Date| WHEN DATEDIFF(DAY, cd.[DateFull], dd.[DateFull]) > 0 THEN DATEDIFF(DAY, cd.[DateFull], dd.[DateFull]) ELSE 0 | |  |
| dwh.Dim_Date cd, dwh.Dim_Date dd|  cd.[DateFull], dd.[DateFull] |dbo.Accounts Payables |M AP Days Over Due Date| WHEN DATEDIFF(DAY, dd.[DateFull], cd.[DateFull]) > 0  THEN DATEDIFF(DAY, dd.[DateFull], cd.[DateFull]) ELSE 0  | |  |
| dwh.Fact_AccountsPayable| FK_BusinessType, FK_Company |dbo.Accounts Payables |Security Key| CONCAT_WS('-', FK_BusinessType, '-1', FK_Company, '-1') | |  |
| dwh.Sec_KeyCombinations| KDP_SK|dbo.Accounts Payables |KeyCombination Key| None | bigint |  False|


---


## Transformation Rules

### Column Specific Transformation
1. Currency Type Key
`Set the Currency Type Key value to 2`

2. M AP Overdue Amount
`WHEN FK_DueDate < FK_ClosingDate
		THEN OpenAmountGroupCurrency
		ELSE 0.00`

3. M AP Overdue > 360 Days Amount
`WHEN DATEDIFF(YEAR, dd.[DateFull], cd.[DateFull]) > 0 
		THEN ap.[OpenAmountGroupCurrency]
		ELSE 0.00`
	
4. M AP Days To Due Date
`	WHEN DATEDIFF(DAY, cd.[DateFull], dd.[DateFull]) > 0 
		THEN DATEDIFF(DAY, cd.[DateFull], dd.[DateFull]) 
		ELSE 0 `
5. M AP Days Over Due Date
		`WHEN DATEDIFF(DAY, dd.[DateFull], cd.[DateFull]) > 0 
		THEN DATEDIFF(DAY, dd.[DateFull], cd.[DateFull]) 
		ELSE 0 `

6. Security Key
`CONCAT_WS('-', FK_BusinessType, '-1', FK_Company, '-1')`

### Joins `dwh.Fact_AccountsPayable ap`

1. dwh.Sec_KeyCombinations KC
`INNER JOIN	dwh.Sec_KeyCombinations	AS KC`
			`ON  ap.FK_BusinessType	= KC.FK_BusinessType`
			`AND ap.FK_Company		= KC.FK_Company`
			`AND KC.FK_BusinessUnit	= -1`
			`AND	KC.FK_CustomerCountry		= -1`

2. dwh_Dim_Currency gcur
`INNER JOIN [dwh].[Dim_Currency] gcur
	ON gcur.[CurrencyCode] = 'USD'`

3. dwh.Dim_Date cd
`INNER JOIN [dwh].[Dim_Date] cd
	ON ap.[FK_ClosingDate] = cd.[KDP_SK]`

4. dwh.Dim_Date id
`INNER JOIN [dwh].[Dim_Date] id
	ON ap.[FK_InvoiceDate] = id.[KDP_SK]`

5. dwh.Dim_Date dd
`INNER JOIN [dwh].[Dim_Date] dd
	ON ap.[FK_DueDate] = dd.[KDP_SK]`

6. Where clause
`WHERE 
	cd.[DateFull] > DATEFROMPARTS(2021,1,1)`
---


## 2nd AP table: Currency Type Key Set to 1

### Field Mapping


| Source Table | Source Field  | Target Table  | Target Field  | Transformation Rules  | Data Type | Nullable  |
|--|--|--|--|--|--|--|
| | |dbo.Accounts Payables |  Currency Type Key | Set to 1| |  |
| dwh.Dim_Currency| KDP_SK|dbo.Accounts Payables |  Currency Key | None | bigint   |  False|
| dwh.Fact_AccountsPayable| FK_Company|dbo.Accounts Payables |  Company Key | None | bigint   |  True|
| dwh.Fact_AccountsPayable| FK_ClosingDate|dbo.Accounts Payables |  Date Closing Key | None | int|  True|
| dwh.Fact_AccountsPayable| FK_BusinessPartner|dbo.Accounts Payables | Business Partner Key | None | bigint   |  True|
| dwh.Fact_AccountsPayable| FK_AgeGroup|dbo.Accounts Payables | Age Group  Key | None | bigint   |  True|
| dwh.Fact_AccountsPayable| FK_BusinessType|dbo.Accounts Payables | Business Type Key | None | bigint   |  True|
| dwh.Dim_Date id| DateFull|dbo.Accounts Payables | Date Invoice| None | date|  True|
| dwh.Dim_Date dd| DateFull|dbo.Accounts Payables | Date Due| None | date|  True|
| dwh.Fact_AccountsPayable| PaymentTerm|dbo.Accounts Payables | Payment Term| None | nvarchar(1000)|  True|
| dwh.Fact_AccountsPayable| InvoiceCode|dbo.Accounts Payables |AP Invoice ID| None | nvarchar(1000)|  True|
| dwh.Fact_AccountsPayable| OriginalInvoiceCode|dbo.Accounts Payables |AP Invoice Number| None | nvarchar(1000)|  True|
| dwh.Fact_AccountsPayable| InvoiceAmountGroupCurrency|dbo.Accounts Payables |M AP Invoice Amount| None | decimal(18, 2)|  True|
| dwh.Fact_AccountsPayable| OpenAmountGroupCurrency|dbo.Accounts Payables |M AP Balance Amount| None | decimal(18, 2)|  True|
| dwh.Fact_AccountsPayable| FK_DueDate, FK_ClosingDate, OpenAmountHomeCurrency|dbo.Accounts Payables |M AP Overdue Amount| WHEN FK_DueDate < FK_ClosingDate THEN OpenAmountHomeCurrencyELSE 0.00||  |
| dwh.Fact_AccountsPayable ap, dwh.Dim_Date dd, dwh.Dim_Date cd|  dd.[DateFull], cd.[DateFull], ap.[OpenAmountHomeCurrency]|dbo.Accounts Payables |M AP Overdue > 360 Days Amount| WHEN DATEDIFF(YEAR, dd.[DateFull], cd.[DateFull]) > 0 THEN ap.[OpenAmountHomeCurrency] ELSE 0.00| |  |
| dwh.Dim_Date cd, dwh.Dim_Date dd|  cd.[DateFull], dd.[DateFull] |dbo.Accounts Payables |M AP Days To Due Date| WHEN DATEDIFF(DAY, cd.[DateFull], dd.[DateFull]) > 0 THEN DATEDIFF(DAY, cd.[DateFull], dd.[DateFull]) ELSE 0 | |  |
| dwh.Dim_Date cd, dwh.Dim_Date dd|  cd.[DateFull], dd.[DateFull] |dbo.Accounts Payables |M AP Days Over Due Date| WHEN DATEDIFF(DAY, dd.[DateFull], cd.[DateFull]) > 0  THEN DATEDIFF(DAY, dd.[DateFull], cd.[DateFull]) ELSE 0  | |  |
| dwh.Fact_AccountsPayable| FK_BusinessType, FK_Company |dbo.Accounts Payables |Security Key| CONCAT_WS('-', FK_BusinessType, '-1', FK_Company, '-1') | |  |
| dwh.Sec_KeyCombinations| KDP_SK|dbo.Accounts Payables |KeyCombination Key| None | bigint |  False|

---


## Transformation Rules

### Column Specific Transformation
1. Currency Type Key
`Set the Currency Type Key value to 1`

2. M AP Overdue Amount
`WHEN FK_DueDate < FK_ClosingDate
		THEN OpenAmountHomeCurrency
		ELSE 0.00`

3. M AP Overdue > 360 Days Amount
`WHEN DATEDIFF(YEAR, dd.[DateFull], cd.[DateFull]) > 0 
		THEN ap.[OpenAmountHomeCurrency]
		ELSE 0.00`
	
4. M AP Days To Due Date
`	WHEN DATEDIFF(DAY, cd.[DateFull], dd.[DateFull]) > 0 
		THEN DATEDIFF(DAY, cd.[DateFull], dd.[DateFull]) 
		ELSE 0 `
5. M AP Days Over Due Date
		`WHEN DATEDIFF(DAY, dd.[DateFull], cd.[DateFull]) > 0 
		THEN DATEDIFF(DAY, dd.[DateFull], cd.[DateFull]) 
		ELSE 0 `

6. Security Key
`CONCAT_WS('-', FK_BusinessType, '-1', FK_Company, '-1')`



### Joins `dwh.Fact_AccountsPayable ap`

1. dwh.Sec_KeyCombinations KC
`INNER JOIN	dwh.Sec_KeyCombinations	AS KC`
			`ON  ap.FK_BusinessType	= KC.FK_BusinessType`
			`AND ap.FK_Company		= KC.FK_Company`
			`AND KC.FK_BusinessUnit	= -1`
			`AND	KC.FK_CustomerCountry		= -1`

2. dwh_Dim_Currency gcur
`INNER JOIN [dwh].[Dim_Currency] gcur
	ON gcur.[CurrencyCode] = 'USD'`

3. dwh.Dim_Date cd
`INNER JOIN [dwh].[Dim_Date] cd
	ON ap.[FK_ClosingDate] = cd.[KDP_SK]`

4. dwh.Dim_Date id
`INNER JOIN [dwh].[Dim_Date] id
	ON ap.[FK_InvoiceDate] = id.[KDP_SK]`

5. dwh.Dim_Date dd
`INNER JOIN [dwh].[Dim_Date] dd
	ON ap.[FK_DueDate] = dd.[KDP_SK]`

6. Where clause
`WHERE 
	cd.[DateFull] > DATEFROMPARTS(2021,1,1)`
---



## 3rd AP table: Currency Type Key Set to 3

### Field Mapping


| Source Table | Source Field  | Target Table  | Target Field  | Transformation Rules  | Data Type | Nullable  |
|--|--|--|--|--|--|--|
| | |dbo.Accounts Payables |  Currency Type Key | Set to 3| |  |
| dwh.Fact_AccountsPayable| FK_InvoiceCurrency |dbo.Accounts Payables |  Currency Key | None | bigint   |  False|
| dwh.Fact_AccountsPayable| FK_Company|dbo.Accounts Payables |  Company Key | None | bigint   |  True|
| dwh.Fact_AccountsPayable| FK_ClosingDate|dbo.Accounts Payables |  Date Closing Key | None | int|  True|
| dwh.Fact_AccountsPayable| FK_BusinessPartner|dbo.Accounts Payables | Business Partner Key | None | bigint   |  True|
| dwh.Fact_AccountsPayable| FK_AgeGroup|dbo.Accounts Payables | Age Group  Key | None | bigint   |  True|
| dwh.Fact_AccountsPayable| FK_BusinessType|dbo.Accounts Payables | Business Type Key | None | bigint   |  True|
| dwh.Dim_Date id| DateFull|dbo.Accounts Payables | Date Invoice| None | date|  True|
| dwh.Dim_Date dd| DateFull|dbo.Accounts Payables | Date Due| None | date|  True|
| dwh.Fact_AccountsPayable| PaymentTerm|dbo.Accounts Payables | Payment Term| None | nvarchar(1000)|  True|
| dwh.Fact_AccountsPayable| InvoiceCode|dbo.Accounts Payables |AP Invoice ID| None | nvarchar(1000)|  True|
| dwh.Fact_AccountsPayable| OriginalInvoiceCode|dbo.Accounts Payables |AP Invoice Number| None | nvarchar(1000)|  True|
| dwh.Fact_AccountsPayable| InvoiceAmountInvoiceCurrency|dbo.Accounts Payables |M AP Invoice Amount| None | decimal(18, 2)|  True|
| dwh.Fact_AccountsPayable| OpenAmountInvoiceCurrency|dbo.Accounts Payables |M AP Balance Amount| None | decimal(18, 2)|  True|
| dwh.Fact_AccountsPayable| FK_DueDate, FK_ClosingDate, OpenAmountInvoiceCurrency|dbo.Accounts Payables |M AP Overdue Amount| WHEN FK_DueDate < FK_ClosingDate THEN OpenAmountInvoiceCurrency ELSE 0.00||  |
| dwh.Fact_AccountsPayable ap, dwh.Dim_Date dd, dwh.Dim_Date cd|  dd.[DateFull], cd.[DateFull], ap.[OpenAmountHomeCurrency]|dbo.Accounts Payables |M AP Overdue > 360 Days Amount| WHEN DATEDIFF(YEAR, dd.[DateFull], cd.[DateFull]) > 0 THEN ap.[OpenAmountInvoiceCurrency] ELSE 0.00| |  |
| dwh.Dim_Date cd, dwh.Dim_Date dd|  cd.[DateFull], dd.[DateFull] |dbo.Accounts Payables |M AP Days To Due Date| WHEN DATEDIFF(DAY, cd.[DateFull], dd.[DateFull]) > 0 THEN DATEDIFF(DAY, cd.[DateFull], dd.[DateFull]) ELSE 0 | |  |
| dwh.Dim_Date cd, dwh.Dim_Date dd|  cd.[DateFull], dd.[DateFull] |dbo.Accounts Payables |M AP Days Over Due Date| WHEN DATEDIFF(DAY, dd.[DateFull], cd.[DateFull]) > 0  THEN DATEDIFF(DAY, dd.[DateFull], cd.[DateFull]) ELSE 0  | |  |
| dwh.Fact_AccountsPayable| FK_BusinessType, FK_Company |dbo.Accounts Payables |Security Key| CONCAT_WS('-', FK_BusinessType, '-1', FK_Company, '-1') | |  |
| dwh.Sec_KeyCombinations| KDP_SK|dbo.Accounts Payables |KeyCombination Key| None | bigint |  False|


---


## Transformation Rules

### Column Specific Transformation
1. Currency Type Key
`Set the Currency Type Key value to 3`

2. M AP Overdue Amount
`WHEN FK_DueDate < FK_ClosingDate
		THEN OpenAmountInvoiceCurrency
		ELSE 0.00`

3. M AP Overdue > 360 Days Amount
`WHEN DATEDIFF(YEAR, dd.[DateFull], cd.[DateFull]) > 0 
		THEN ap.[OpenAmountInvoiceCurrency]
		ELSE 0.00`
	
4. M AP Days To Due Date
`	WHEN DATEDIFF(DAY, cd.[DateFull], dd.[DateFull]) > 0 
		THEN DATEDIFF(DAY, cd.[DateFull], dd.[DateFull]) 
		ELSE 0 `
5. M AP Days Over Due Date
		`WHEN DATEDIFF(DAY, dd.[DateFull], cd.[DateFull]) > 0 
		THEN DATEDIFF(DAY, dd.[DateFull], cd.[DateFull]) 
		ELSE 0 `

6. Security Key
`CONCAT_WS('-', FK_BusinessType, '-1', FK_Company, '-1')`



### Joins `dwh.Fact_AccountsPayable ap`

1. dwh.Sec_KeyCombinations KC
`INNER JOIN	dwh.Sec_KeyCombinations	AS KC`
			`ON  ap.FK_BusinessType	= KC.FK_BusinessType`
			`AND ap.FK_Company		= KC.FK_Company`
			`AND KC.FK_BusinessUnit	= -1`
			`AND	KC.FK_CustomerCountry		= -1`

2. dwh.Dim_Date cd
`INNER JOIN [dwh].[Dim_Date] cd
	ON ap.[FK_ClosingDate] = cd.[KDP_SK]`

3. dwh.Dim_Date id
`INNER JOIN [dwh].[Dim_Date] id
	ON ap.[FK_InvoiceDate] = id.[KDP_SK]`

4. dwh.Dim_Date dd
`INNER JOIN [dwh].[Dim_Date] dd
	ON ap.[FK_DueDate] = dd.[KDP_SK]`

5. Where clause
`WHERE 
	cd.[DateFull] > DATEFROMPARTS(2021,1,1)`

---
### UNION ALL

Once you have these 3 tables, it's combined using Union ALL 

---
### [Return to Fact Tables](/Archive/Data-Lineage/Fact-Tables)