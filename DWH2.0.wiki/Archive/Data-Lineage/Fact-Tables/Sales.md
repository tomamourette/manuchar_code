---
# Sales Mapping
---

## Introduction

Sales is based on a SQL View in DWH called **dbo.Sales** which will be the _Target_ and it is derived from combining 3 tables, the 1st table is based on **dwh.Fact_Invoices** and the 2nd and 3rd table are based on **dwh.Fact_SalesPlans**  will both be the _Source_.

The view is generated by creating 3 tables  with different Actual Budget(Actual, Budget and Forecast) and combining these 3 tables by using union all. Each table generated has joins with these tables:
- dwh.Dim_Customer;
- dwh.Dim_Country;
- dwh.Sec_KeyCombinations;
- dwh.Dim_LocalProduct;
- dwh.Dim_Currency;

---

## Data Lineage

::: mermaid
 graph LR;
 A[dwh.Fact_Invoices Actual] --> B[dbo.Sales] -->  C[Sales];
D[dwh.Fact_SalesPlans Budget] -->  B;
E[dwh.Fact_SalesPlans Forecast] -->  B;
:::

---

## Source Details 

Source Name: `dwh.Fact_invoices` 
Source Type: `Table`
Source System: `DWH SQL Server`


|Table Name| Column Name| Data Type  |  Nullable | Description   |
|--|--|--|--|--|
|dwh.Fact_invoices|  InvoiceCode|  nvarchar(50) | True||
|dwh.Fact_invoices|  InvoiceLineNumber|  bigint | True  ||
|dwh.Fact_invoices|  FK_Company|  bigint | True  ||
|dwh.Fact_invoices|  FK_InvoiceDate|  int| True  ||
|dwh.Fact_invoices|  FK_ClosingDate|  int| True  ||
|dwh.Fact_invoices|  FK_BusinessUnit|  bigint | True  ||
|dwh.Fact_invoices|  FK_BusinessType|  bigint | True  ||
|dwh.Fact_invoices|  FK_Customer|  bigint | True  ||
|dwh.Fact_invoices|  FK_Industry|  bigint | True  ||
|dwh.Fact_invoices|  FK_InvoiceCurrency|  bigint | True  ||
|dwh.Fact_invoices|  FK_HomeCurrency|  bigint | True  ||
|dwh.Fact_invoices|  FK_DestinationCountry|  bigint | True  ||
|dwh.Fact_invoices|  FK_Product|  bigint | True  ||
|dwh.Fact_invoices|  FK_ProductGrouping|  bigint | True  ||
|dwh.Fact_invoices|  FK_LocalProduct|  bigint | True  ||
|dwh.Fact_invoices|  FK_UnitOfMeasure|  bigint | True  ||
|dwh.Fact_invoices|  FK_Invoice|  bigint | True  ||
|dwh.Fact_invoices|  Quantity|  decimal(38,5) | True  ||
|dwh.Fact_invoices|  QuantityInMetricTon|  decimal(38,5) | True  ||
|dwh.Fact_invoices|  IsNewFile|  bit | True  ||
|dwh.Fact_invoices|  Shares|  decimal(38,5) | True  ||
|dwh.Fact_invoices|  ExternalReference|  nvarchar(1000) | True  ||
|dwh.Fact_invoices|  SalesAmountInvoiceCurrency|  float | True  ||
|dwh.Fact_invoices|  SalesAmountHomeCurrency|  float | True  ||
|dwh.Fact_invoices|  SalesAmountGroupCurrency|  float | True  ||
|dwh.Fact_invoices|  CostOfGoodsSoldAmountInvoiceCurrency|  float | True  ||
|dwh.Fact_invoices|  CostOfGoodsSoldAmountHomeCurrency|  float | True  ||
|dwh.Fact_invoices|  CostOfGoodsSoldAmountGroupCurrency|  float | True  ||
|dwh.Fact_invoices|  ContributionAmountInvoiceCurrency|  float | True  ||
|dwh.Fact_invoices|  ContributionAmountHomeCurrency|  float | True  ||
|dwh.Fact_invoices|  ContributionAmountGroupCurrency|  float | True  ||
|dwh.Fact_invoices|  UnitPriceInvoiceCurrency|  float | True  ||
|dwh.Fact_invoices|  UnitPriceHomeCurrency|  float | True  ||
|dwh.Fact_invoices|  UnitPriceAmountGroupCurrency|  float | True  ||
|dwh.Fact_invoices|  ExternalTransportAmountInvoiceCurrency|  float | True  ||
|dwh.Fact_invoices|  ExternalTransportAmountHomeCurrency|  float | True  ||
|dwh.Fact_invoices|  ExternalTransportAmountGroupCurrency|  float | True  ||
|dwh.Fact_invoices|  InternalTransportAmountInvoiceCurrency|  float | True  ||
|dwh.Fact_invoices|  InternalTransportAmountHomeCurrency|  float | True  ||
|dwh.Fact_invoices|  InternalTransportAmountGroupCurrency|  float | True  ||
|dwh.Fact_invoices|  CostOfGoodsSold2AmountInvoiceCurrency|  float | True  ||
|dwh.Fact_invoices|  CostOfGoodsSold2AmountHomeCurrency|  float | True  ||
|dwh.Fact_invoices|  CostOfGoodsSold2AmountGroupCurrency|  float | True  ||
|dwh.Fact_invoices|  Contribution2AmountInvoiceCurrency|  float | True  ||
|dwh.Fact_invoices|  Contribution2AmountHomeCurrency|  float | True  ||
|dwh.Fact_invoices|  Contribution2AmountGroupCurrency|  float | True  ||


---

Source Name: `dwh.Fact_SalesPlans` 
Source Type: `Table`
Source System: `DWH SQL Server`


|Table Name| Column Name| Data Type  |  Nullable | Description   |
|--|--|--|--|--|
|dwh.Fact_SalesPlans|  BudgetLineNumber|  bigint | True  ||
|dwh.Fact_SalesPlans|  FK_Company|  bigint | True  ||
|dwh.Fact_SalesPlans|  FK_ClosingDate|  int| True  ||
|dwh.Fact_SalesPlans|  FK_Customer|  bigint | True  ||
|dwh.Fact_SalesPlans|  FK_Industry|  bigint | True  ||
|dwh.Fact_SalesPlans|  FK_HomeCurrency|  bigint | True  ||
|dwh.Fact_SalesPlans|  FK_BusinessUnit|  bigint | True  ||
|dwh.Fact_SalesPlans|  FK_BusinessType|  bigint | True  ||
|dwh.Fact_SalesPlans|  FK_DestinationCountry|  bigint | True  ||
|dwh.Fact_SalesPlans|  FK_Product|  bigint | True  ||
|dwh.Fact_SalesPlans|  FK_ProductGrouping|  bigint | True  ||
|dwh.Fact_SalesPlans|  FK_UnitOfMeasure|  bigint | True  ||
|dwh.Fact_SalesPlans|  BudgetAmountHomeCurrency|  float | True  ||
|dwh.Fact_SalesPlans|  BudgetAmountBudgetCurrency|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  BudgetAmountGroupCurrency|  float | True  ||
|dwh.Fact_SalesPlans|  BudgetCostOfGoodsSold1AmountHomeCurrency|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  BudgetCostOfGoodsSold1AmountBudgetCurrency|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  BudgetCostOfGoodsSold1AmountGroupCurrency|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  BudgetCostOfGoodsSold2AmountHomeCurrency|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  BudgetCostOfGoodsSold2AmountBudgetCurrency|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  BudgetCostOfGoodsSold2AmountGroupCurrency|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  BudgetContribution1AmountHomeCurrency|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  BudgetContribution1AmountBudgetCurrency|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  BudgetContribution1AmountGroupCurrency|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  BudgetContribution2AmountHomeCurrency|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  BudgetContribution2AmountBudgetCurrency|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  BudgetContribution2AmountGroupCurrency|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  BudgetQuantity|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  BudgetQuantityInMetricTon|  decimal(38,5) | True  ||
|dwh.Fact_SalesPlans|  SalesPlan|  nvarchar(50) | True  ||
|dwh.Fact_SalesPlans|  SalesPlanCategory|  nvarchar(50) | True  ||
|dwh.Fact_SalesPlans|  SalesPlanVersion|  nvarchar(50) | True  ||


---

Source Name: `dwh.Dim_Customer`
Source Type: `Table`
Source System: `DWH SQL Server`

|Table Name| Column Name| Data Type  |  Nullable | Description   |
|--|--|--|--|--|
|dwh.Dim_Customer|  CustomerCode |  nvarchar(503) | False||
|dwh.Dim_Customer|  CustomerName|  nvarchar(500) | True  ||
|dwh.Dim_Customer|  LegalNumber|  nvarchar(50) | True  ||
|dwh.Dim_Customer|  CountryCode|  nvarchar(20) | True  ||
|dwh.Dim_Customer|  CountryName|  nvarchar(500) | True  ||
|dwh.Dim_Customer|  CommercialRegionName|  nvarchar(500) | True  ||
|dwh.Dim_Customer|  Address|  nvarchar(500) | True  ||
|dwh.Dim_Customer|  ZIPCode|  nvarchar(20) | True  ||
|dwh.Dim_Customer|  City|  nvarchar(500) | True  ||
|dwh.Dim_Customer|  CurrencyCode|  nvarchar(20) | True  ||
|dwh.Dim_Customer|  MultinationalCustomerCode|  nvarchar(500) | True  ||
|dwh.Dim_Customer|  MultinationalCustomerName|  nvarchar(500) | True  ||
|dwh.Dim_Customer|  MultinationalLegalNumber|  nvarchar(50) | True  ||
|dwh.Dim_Customer|  MultinationalCountryCode|  nvarchar(20) | True  ||
|dwh.Dim_Customer|  MultinationalCountryName|  nvarchar(500) | True  ||
|dwh.Dim_Customer|  AffiliateCode|  nvarchar(20) | True  ||
|dwh.Dim_Customer|  AffiliateDescription|  nvarchar(500) | True  ||
|dwh.Dim_Customer|  IsAffiliate|  bit | True  ||
|dwh.Dim_Customer|  IndustryTypeCode|  nvarchar(20) | True  ||
|dwh.Dim_Customer|  IndustryTypeDescription|  nvarchar(500) | True  ||
|dwh.Dim_Customer|  MNCParentCode|  nvarchar(20) | True  ||
|dwh.Dim_Customer|  MNCParentName|  nvarchar(500) | True  ||
|dwh.Dim_Customer|  CreatedDateTime|  datetime(3) | True  ||
|dwh.Dim_Customer|  ModifiedDateTime|  datetime(3) | True  ||
|dwh.Dim_Customer|  ValidationStatus|  nvarchar(50) | True  ||
|dwh.Dim_Customer|  KDP_SK|  bigint IDENTITY(1,1) | False||
|dwh.Dim_Customer|  KDP_checksum|  int | True  ||
|dwh.Dim_Customer|  KDP_executionId|  int | True  ||
|dwh.Dim_Customer|  KDP_loadDT|  datetime | True  ||
---

Source Name: `dwh.Dim_Country`
Source Type: `Table`
Source System: `DWH SQL Server`


|Table Name| Column Name| Data Type  |  Nullable | Description   |
|--|--|--|--|--|
|dwh.Dim_Country|  CountryCode|  nvarchar(20) | True  ||
|dwh.Dim_Country|  CountryName|  nvarchar(500) | True  ||
|dwh.Dim_Country|  ISOAlphaCode|  nvarchar(20) | True  ||
|dwh.Dim_Country|  ISONumericCode|  nvarchar(20) | True  ||
|dwh.Dim_Country|  CommercialRegionCode|  nvarchar(20) | True  ||
|dwh.Dim_Country|  CommercialRegionName|  nvarchar(500) | True  ||
|dwh.Dim_Country|  CreatedDateTime|  datetime2(3) | True  ||
|dwh.Dim_Country|  ModifiedDateTime|  datetime2(3) | True  ||
|dwh.Dim_Country|  ValidationStatus|  nvarchar(50) | True  ||
|dwh.Dim_Country|  KDP_SK|  bigint IDENTITY(1,1) | False||
|dwh.Dim_Country|  KDP_checksum|  int | True  ||
|dwh.Dim_Country|  KDP_executionId|  int | True  ||
|dwh.Dim_Country|  KDP_loadDT|  datetime| True  ||
---

Source Name: `dwh.Sec_KeyCombinations`
Source Type: `Table`
Source System: `DWH SQL Server`


|Table Name| Column Name| Data Type  |  Nullable | Description   |
|--|--|--|--|--|
|dwh.Sec_KeyCombinations|  KDP_SK|  bigint IDENTITY(1,1) | False||
|dwh.Sec_KeyCombinations|  FK_BusinessType|  bigint | False||
|dwh.Sec_KeyCombinations|  FK_BusinessUnit|  bigint | False||
|dwh.Sec_KeyCombinations|  FK_CustomerCountry|  bigint| False||
|dwh.Sec_KeyCombinations|  FK_Company|  bigint| False||
---


Source Name: `dwh.Dim_LocalProduct`
Source Type: `Table`
Source System: `DWH SQL Server`

|Table Name| Column Name| Data Type  |  Nullable | Description   |
|--|--|--|--|--|
|dwh.Dim_LocalProduct|  LocalProductCode|  nvarchar(500) | True  ||
|dwh.Dim_LocalProduct|  LocalProductName|  nvarchar(500) | True  ||
|dwh.Dim_LocalProduct|  GroupProductCode|  nvarchar(50) | True  ||
|dwh.Dim_LocalProduct|  GroupProductName|  nvarchar(500) | True  ||
|dwh.Dim_LocalProduct|  ProductGroupingCode|  nvarchar(50) | True  ||
|dwh.Dim_LocalProduct|  ProductGroupingName|  nvarchar(500) | True  ||
|dwh.Dim_LocalProduct|  ProductBusinessUnitCode|  nvarchar(20) | True  ||
|dwh.Dim_LocalProduct|  ProductBusinessUnitName|  nvarchar(500) | True  ||
|dwh.Dim_LocalProduct|  ProductCategory|  nvarchar(500) | True  ||
|dwh.Dim_LocalProduct|  ProductSubcategory|  nvarchar(500) | True  ||
|dwh.Dim_LocalProduct|  CompanyCode|  nvarchar(1000) | True  ||
|dwh.Dim_LocalProduct|  CompanyName|  nvarchar(500) | True  ||
|dwh.Dim_LocalProduct|  GradeCode|  nvarchar(50) | True  ||
|dwh.Dim_LocalProduct|  GradeDescription|  nvarchar(500) | True  ||
|dwh.Dim_LocalProduct|  PackagingTypeCode|  nvarchar(50) | True  ||
|dwh.Dim_LocalProduct|  PackagingTypeDescription|  nvarchar(500) | True  ||
|dwh.Dim_LocalProduct|  FormCode|  nvarchar(50) | True  ||
|dwh.Dim_LocalProduct|  FormDescription|  nvarchar(500) | True  ||
|dwh.Dim_LocalProduct|  PackagingSize|  decimal(18,2) | True  ||
|dwh.Dim_LocalProduct|  PackagingUnitOfMeasureCode|  nvarchar(20) | True  ||
|dwh.Dim_LocalProduct|  PackagingUnitOfMeasureDescription|  nvarchar(500) | True  ||
|dwh.Dim_LocalProduct|  Quality|  decimal(18,2) | True  ||
|dwh.Dim_LocalProduct|  CAS|  nvarchar(500) | True  ||
|dwh.Dim_LocalProduct|  Chemwatch|  nvarchar(500) | True  ||
|dwh.Dim_LocalProduct|  MSDSDate|  datetime2(3)| True  ||
|dwh.Dim_LocalProduct|  CreatedDateTime|  datetime2(3)| True  ||
|dwh.Dim_LocalProduct|  ModifiedDateTime|  datetime2(3)| True  ||
|dwh.Dim_LocalProduct|  ValidationStatus|  nvarchar(50) | True  ||
|dwh.Dim_LocalProduct|  KDP_SK|  bigint IDENTITY(1,1)| False||
|dwh.Dim_LocalProduct|  KDP_checksum|  int | True  ||
|dwh.Dim_LocalProduct|  KDP_executionId|  int | True  ||
|dwh.Dim_LocalProduct|  KDP_loadDT|  datetime| True  ||

---

Source Name: `dwh.Dim_Currency`
Source Type: `Table`
Source System: `DWH SQL Server`

|Table Name| Column Name| Data Type  |  Nullable | Description   |
|--|--|--|--|--|
|dwh.Dim_Currency|  CurrencyCode|  nvarchar(20) | True  ||
|dwh.Dim_Currency|  IsActive|  bit | True  ||
|dwh.Dim_Currency|  Currency|  nvarchar(500) | True  ||
|dwh.Dim_Currency|  KDP_SK|  bigint IDENTITY(1,1) | False||
|dwh.Dim_Currency|  KDP_checksum|  int | True  ||
|dwh.Dim_Currency|  KDP_executionId|  int | True  ||
|dwh.Dim_Currency|  KDP_loadDT|  datetime | True  ||


---

## Target Details
Target Name: `dbo.Sales`
Target Type: `View`
Target System: `DWH SQL Server`

|View Name| Column Name| Data Type  |  Nullable | Description   |
|--|--|--|--|--|
|dbo.Sales  |  PK_Sales |  | ||
|dbo.Sales |  Invoice Key |  bigint | True||
|dbo.Sales |  Company Key |  bigint| True||
|dbo.Sales |  Date Closing Key|  int| True||
|dbo.Sales |  Customer Key |  bigint| True||
|dbo.Sales |  Industry Key |  bigint| True||
|dbo.Sales |  Currency Key |  bigint| True||
|dbo.Sales |  Business Unit Key |  bigint| True||
|dbo.Sales |  Business Type Key |  bigint| True||
|dbo.Sales |  Destination Country Key |  bigint| True||
|dbo.Sales |  Product Key |  bigint| True||
|dbo.Sales |  Product Groups Key |  bigint| True||
|dbo.Sales |  Product Local Key |  bigint| True||
|dbo.Sales |  UOM Key |  bigint| True||
|dbo.Sales |  Product Grade |  nvarchar(500) | True||
|dbo.Sales |  Product Form |  nvarchar(500) | True||
|dbo.Sales |  Product Packaging Type |  nvarchar(500) | True||
|dbo.Sales |  Product Packaging Size |  decimal (18,2) | True||
|dbo.Sales |  Product Packaging UOM |  nvarchar(20) | True||
|dbo.Sales |  Product Quality|  decimal (18,2) | True||
|dbo.Sales |  New Files  |  bit | True||
|dbo.Sales |  Product Quality|  decimal (38, 5) | True||
|dbo.Sales |  External Reference|  nvarchar(1000) | True||
|dbo.Sales |  M Quantity|  decimal (38, 5) | True||
|dbo.Sales |  M Quantity in MT|  decimal (38, 5) | True||
|dbo.Sales |  M Sales Amount Invoice Currency|  Float | True||
|dbo.Sales |  M Sales Amount Home Currency|  Float | True||
|dbo.Sales |  M Sales Amount Group Currency|  Float | True||
|dbo.Sales |  M COGS Amount Home Currency|  Float | True||
|dbo.Sales |  M COGS Amount Group Currency|  Float | True||
|dbo.Sales |  M Contribution Amount Home Currency|  Float | True||
|dbo.Sales |  M Contribution Amount Group Currency|  Float | True||
|dbo.Sales |  M Cost External Transport Amount Home Currency|  Float | True||
|dbo.Sales |  M Cost External Transport Amount Group Currency|  Float | True||
|dbo.Sales |  M Cost Internal Transport Amount Home Currency|  Float | True||
|dbo.Sales |  M Cost Internal Transport Amount Group Currency|  Float | True||
|dbo.Sales |  M COGS2 Amount Home Currency|  Float | True||
|dbo.Sales |  M COGS2 Amount Group Currency|  Float | True||
|dbo.Sales |  M Contribution2 Amount Home Currency|  Float | True||
|dbo.Sales |  M Contribution2 Amount Group Currency|  Float | True||
|dbo.Sales |  M Unit Price Amount Home Currency|  Float | True||
|dbo.Sales |  M Unit Price Amount Group Currency|  Float | True||
|dbo.Sales |  M Budget Amount Budget Currency|  Float | True||
|dbo.Sales |  M Budget Amount Home Currency|  Float | True||
|dbo.Sales |  M Budget Amount Group Currency|  Float | True||
|dbo.Sales |  M Budget COGS1 Amount Budget Currency|  Float | True||
|dbo.Sales |  M Budget COGS1 Amount Home Currency|  Float | True||
|dbo.Sales |  M Budget COGS1 Amount Group Currency|  Float | True||
|dbo.Sales |  M Budget Contribution Budget Currency|  Float | True||
|dbo.Sales |  M Budget Contribution Home Currency|  Float | True||
|dbo.Sales |  M Budget Contribution Group Currency|  Float | True||
|dbo.Sales |  M Budget COGS2 Amount Budget Currency|  Float | True||
|dbo.Sales |  M Budget COGS2 Amount Home Currency|  Float | True||
|dbo.Sales |  M Budget COGS2 Amount Group Currency|  Float | True||
|dbo.Sales |  M Budget Contribution2 Budget Currency|  Float | True||
|dbo.Sales |  M Budget Contribution2 Home Currency|  Float | True||
|dbo.Sales |  M Budget Contribution2 Group Currency|  Float | True||
|dbo.Sales |  M Budget Quantity|  Float | True||
|dbo.Sales |  M Budget Quantity in MT |  Float | True||
|dbo.Sales |  M Budget Quantity in MT |  Float | True||
|dbo.Sales |  ActualBudget |  | ||
|dbo.Sales |  Security Key |  | ||
|dbo.Sales |  UOM Code |  | ||
|dbo.Sales |  UOM Name |  | ||
|dbo.Sales |  Home Currency |  nvarchar(20) | True||
|dbo.Sales |  KeyCombination Key |  bigint IDENTITY(1,1) | False||





---
## 1st table: ActualBudget: 'Actual'

### Field Mapping


| Source Table | Source Field  | Target Table  | Target Field  | Transformation Rules  | Data Type | Nullable  |
|--|--|--|--|--|--|--|
| dwh.Fact_invoices| InvoiceCode, InvoiceLineNumber,FK_Company,FK_Customer,  FK_Industry, FK_ClosingDate, FK_LocalProduct |dbo.Sales|  PK_Sales| ROW_NUMBER() OVER (ORDER BY InvoiceCode, InvoiceLineNumber, FK_Company, FK_Customer, FK_Industry, FK_ClosingDate, FK_LocalProduct) | bigint   |  False|
| dwh.Fact_invoices | FK_Invoice |dbo.Sales |  Invoice Key | None | bigint   |  True|
| dwh.Fact_invoices | FK_Company |dbo.Sales |  Company Key | None | bigint   |  True|
| dwh.Fact_invoices| FK_ClosingDate |dbo.Sales |  Date Closing Key | None | int|  True|
| dwh.Fact_invoices | FK_Customer |dbo.Sales |  Customer Key | None | bigint   |  True|
| dwh.Fact_invoices | FK_Industry |dbo.Sales |  Industry Key | None | bigint   |  True|
| dwh.Fact_invoices | FK_InvoiceCurrency |dbo.Sales |  Currency Key | None | bigint   |  True|
| dwh.Fact_invoices | FK_BusinessUnit |dbo.Sales |  Business Unit Key | None | bigint   |  True|
| dwh.Fact_invoices | FK_BusinessType |dbo.Sales |  Business Type Key | None | bigint   |  True|
| dwh.Fact_invoices | FK_DestinationCountry |dbo.Sales | Destination Country Key | None | bigint   |  True|
| dwh.Fact_invoices | FK_Product |dbo.Sales | Product Key | None | bigint   |  True|
| dwh.Fact_invoices | FK_ProductGrouping |dbo.Sales | Product Groups Key | None | bigint   |  True|
| dwh.Fact_invoices | FK_LocalProduct |dbo.Sales | Product Local Key | None | bigint   |  True|
| dwh.Fact_invoices | FK_UnitOfMeasure |dbo.Sales | UOM Key | None | bigint   |  True|
| dwh.Dim_LocalProduct | GradeDescription |dbo.Sales | Product Grade | COALESCE(GradeDescription, 'N/A') | nvarchar(500)   |  True|
| dwh.Dim_LocalProduct | FormDescription |dbo.Sales | Product Form | COALESCE(FormDescription, 'N/A') | nvarchar(500)   |  True|
| dwh.Dim_LocalProduct | PackagingTypeDescription |dbo.Sales | Product Packaging Type | COALESCE(PackagingTypeDescription, 'N/A') | nvarchar(500)   |  True|
| dwh.Dim_LocalProduct | PackagingSize |dbo.Sales | Product Packaging Size | COALESCE(PackagingSize, 0.0) | decimal (18,2)  |  True|
| dwh.Dim_LocalProduct | PackagingUnitOfMeasureCode |dbo.Sales | Product Packaging UOM | COALESCE(PackagingUnitOfMeasureCode, 'N/A') | nvarchar(20)  |  True|
| dwh.Dim_LocalProduct | Quality |dbo.Sales | Product Quality | COALESCE(Quality, 0.0) | decimal (18,2)  |  True|
| dwh.Fact_invoices | IsNewFile |dbo.Sales | New Files | None | bit   |  True|
| dwh.Fact_invoices | Shares |dbo.Sales | Shares | None | decimal (38, 5) |  True|
| dwh.Fact_invoices | ExternalReference |dbo.Sales | External Reference | None | nvarchar(1000) |  True|
| dwh.Fact_invoices | Quantity |dbo.Sales | M Quantity | None | decimal (38, 5)   |  True|
| dwh.Fact_invoices | QuantityInMetricTon |dbo.Sales | M Quantity in MT |None | decimal (38, 5) |  True|
| dwh.Fact_invoices | SalesAmountInvoiceCurrency |dbo.Sales | M Sales Amount Invoice Currency |None | float |  True|
| dwh.Fact_invoices | SalesAmountHomeCurrency |dbo.Sales | M Sales Amount Home Currency |None | float |  True|
| dwh.Fact_invoices | SalesAmountGroupCurrency |dbo.Sales | M Sales Amount Group Currency |None | float |  True|
| dwh.Fact_invoices | CostOfGoodsSoldAmountHomeCurrency |dbo.Sales | M COGS Amount Home Currency |None | float |  True|
| dwh.Fact_invoices | CostOfGoodsSoldAmountGroupCurrency |dbo.Sales | M COGS Amount Group Currency |None | float |  True|
| dwh.Fact_invoices | ContributionAmountHomeCurrency |dbo.Sales | M Contribution Home Currency |None | float |  True|
| dwh.Fact_invoices | ContributionAmountGroupCurrency |dbo.Sales | M Contribution Group Currency |None | float |  True|
| dwh.Fact_invoices | ExternalTransportAmountHomeCurrency |dbo.Sales | M Cost External Transport Amount Home Currency |None | float |  True|
| dwh.Fact_invoices | ExternalTransportAmountGroupCurrency |dbo.Sales | M Cost External Transport Amount  Group Currency |None | float |  True|
| dwh.Fact_invoices | InternalTransportAmountHomeCurrency |dbo.Sales | M Cost Internal Transport Amount Home Currency |None | float |  True|
| dwh.Fact_invoices | InternalTransportAmountGroupCurrency |dbo.Sales | M Cost Internal Transport Amount  Group Currency |None | float |  True|
| dwh.Fact_invoices | CostOfGoodsSold2AmountHomeCurrency |dbo.Sales | M COGS2 Amount Home Currency |None | float |  True|
| dwh.Fact_invoices | CostOfGoodsSold2AmountGroupCurrency |dbo.Sales | M COGS2 Amount  Group Currency |None | float |  True|
| dwh.Fact_invoices | Contribution2AmountHomeCurrency |dbo.Sales | M Contribution2 Home Currency |None | float |  True|
| dwh.Fact_invoices | Contribution2AmountGroupCurrency |dbo.Sales | M Contribution2 Group Currency |None | float |  True|
| dwh.Fact_invoices | UnitPriceHomeCurrency |dbo.Sales | M Unit Price Home Currency |None | float |  True|
| dwh.Fact_invoices | UnitPriceAmountGroupCurrency |dbo.Sales | M Unit Price Group Currency |None | float |  True|
|  |  |dbo.Sales | M Budget Amount Budget Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget Amount Home Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget Amount Group Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget COGS1 Amount Budget Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget COGS1  Amount Home Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget COGS1 Amount Group Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget Contribution Budget Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget Contribution Home Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget Contribution Group Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget COGS2 Amount Budget Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget COGS2  Amount Home Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget COGS2 Amount Group Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget Contribution2 Budget Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget Contribution2 Home Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget Contribution2 Group Currency | 0.00 | float |  |
|  |  |dbo.Sales | M Budget Quantity | 0.00 | float |  |
|  |  |dbo.Sales | M Budget Quantity in MT | 0.00 | float |  |
|  |  |dbo.Sales | ActualBudget | 'Actual' | |  |
| dwh.Fact_invoices| FK_BusinessType, FK_BusinessUnit,FK_Company,FK_Customer  |dbo.Sales |Security Key| CONCAT_WS('-', FK_BusinessType, FK_BusinessUnit, FK_Company, FK_Customer) | |  |
|  |  |dbo.Sales | UOM Code | 'N/A' | |  |
|  |  |dbo.Sales | UOM Name | 'N/A' | |  |
| dwh.Dim_Currency| CurrencyCode |dbo.Sales |Home Currency| None | nvarchar(20) |  False|
| dwh.Sec_KeyCombinations| KDP_SK|dbo.Sales |KeyCombination Key| None | bigint |  False|

---

## Transformation Rules

### Column Specific Transformation
1. PK Sales
`ROW_NUMBER() OVER (ORDER BY i.[InvoiceCode], i.[InvoiceLineNumber], i.[FK_Company], i.[FK_Customer], i.[FK_Industry], i.[FK_ClosingDate], i.[FK_LocalProduct])`

2. Product Grade
`COALESCE(lp.[GradeDescription], 'N/A')`

3. Product Form
`COALESCE(lp.[FormDescription], 'N/A')`

4. Product Packaging Type
`COALESCE(lp.[PackagingTypeDescription], 'N/A')`

5. Product Packaging Size
`COALESCE(lp.[PackagingSize], 0.0)`

6. Product Packaging UOM
`COALESCE(lp.[PackagingUnitOfMeasureCode], 'N/A')`

7. Product Quality
`COALESCE(lp.[Quality], 0.0)`

8. Set default value to 0.0 for these columns
`0.00 AS [M Budget Amount Budget Currency]`
`0.00 AS [M Budget Amount Home Currency]`
	`0.00 AS [M Budget Amount Group Currency]`
	`0.00 AS [M Budget COGS1 Amount Budget Currency]`
	`0.00 AS [M Budget COGS1 Amount Home Currency]`
	`0.00 AS [M Budget COGS1 Amount Group Currency]`
	`0.00 AS [M Budget Contribution Budget Currency]`
	`0.00 AS [M Budget Contribution Home Currency]`
	`0.00 AS [M Budget Contribution Group Currency]`
	`0.00 AS [M Budget COGS2 Amount Budget Currency]`
	`0.00 AS [M Budget COGS2 Amount Home Currency]`
	`0.00 AS [M Budget COGS2 Amount Group Currency]`
	`0.00 AS [M Budget Contribution2 Budget Currency]`
	`0.00 AS [M Budget Contribution2 Home Currency]`
	`0.00 AS [M Budget Contribution2 Group Currency]`
	`0.00 AS [M Budget Quantity]`
	`0.00 AS [M Budget Quantity in MT]`

9. ActualBudget set to Actual
`'Actual' AS [ActualBudget]`

10. Security Key
`CONCAT_WS('-', i.[FK_BusinessType], i.[FK_BusinessUnit], i.[FK_Company], i.[FK_Customer])`

11. Set default value to 'N/A' for these columns
`'N/A' AS [UOM Code]`
	`'N/A' AS [UOM Name]`


### Joins `dwh.Fact_Invoices i`

1. dwh.Dim_Customer cust
`LEFT join dwh.Dim_Customer cust on cust.KDP_SK = i.FK_Customer`

2. dwh.Dim_Country ctr
`LEFT join dwh.Dim_Country ctr on ctr.CountryCode = cust.CountryCode`

3. dwh.Sec_KeyCombinations KC
`INNER JOIN	dwh.Sec_KeyCombinations	AS KC`
			`ON  i.FK_BusinessType	= KC.FK_BusinessType`
			`AND i.FK_Company		= KC.FK_Company`
			`AAND i.FK_BusinessUnit	= KC.FK_BusinessUnit`
			`AND	i.FK_DestinationCountry		= KC.FK_CustomerCountry`

4. dwh.Dim_LocalProduct lp
`LEFT OUTER JOIN [dwh].[Dim_LocalProduct] lp
	ON i.[FK_LocalProduct] = lp.[KDP_SK]`

5. dwh_Dim_Currency hcur
`LEFT OUTER JOIN [dwh].[Dim_Currency] hcur
	ON i.[FK_HomeCurrency] = hcur.[KDP_SK]`




---


## 2nd table: ActualBudget: 'Budget'

### Field Mapping


| Source Table | Source Field  | Target Table  | Target Field  | Transformation Rules  | Data Type | Nullable  |
|--|--|--|--|--|--|--|
| dwh.Fact_SalesPlans| FK_Company, FK_ClosingDate, FK_Customer,  FK_Product, SalesPlan, BudgetLineNumber |dbo.Sales|  PK_Sales| ROW_NUMBER() OVER (ORDER BY FK_Company, FK_ClosingDate,  FK_Customer, FK_Product, SalesPlan, BudgetLineNumber) * -1  | bigint   |  False|
| |  |dbo.Sales |  Invoice Key | -1 | bigint   |  True|
| dwh.Fact_SalesPlans | FK_Company |dbo.Sales |  Company Key | None | bigint   |  True|
| dwh.Fact_SalesPlans| FK_ClosingDate |dbo.Sales |  Date Closing Key | None | int|  True|
| dwh.Fact_SalesPlans | FK_Customer |dbo.Sales |  Customer Key | None | bigint   |  True|
| dwh.Fact_SalesPlans | FK_Industry |dbo.Sales |  Industry Key | None | bigint   |  True|
| dwh.Fact_SalesPlans | FK_HomeCurrency |dbo.Sales |  Currency Key | None | bigint   |  True|
| dwh.Fact_SalesPlans | FK_BusinessUnit |dbo.Sales |  Business Unit Key | None | bigint   |  True|
| dwh.Fact_SalesPlans | FK_BusinessType |dbo.Sales |  Business Type Key | None | bigint   |  True|
| dwh.Fact_SalesPlans | FK_DestinationCountry |dbo.Sales | Destination Country Key | None | bigint   |  True|
| dwh.Fact_SalesPlans | FK_Product |dbo.Sales | Product Key | None | bigint   |  True|
| dwh.Fact_SalesPlans | FK_ProductGrouping |dbo.Sales | Product Groups Key | None | bigint   |  True|
|  |  |dbo.Sales | Product Local Key | -1 | bigint   |  True|
| dwh.Fact_SalesPlans | FK_UnitOfMeasure |dbo.Sales | UOM Key | None | bigint   |  True|
|  |  |dbo.Sales | Product Grade | 'N/A' | nvarchar(500)   |  True|
|  |  |dbo.Sales | Product Form | 'N/A' | nvarchar(500)   |  True|
|  |  |dbo.Sales | Product Packaging Type | 'N/A' | nvarchar(500)   |  True|
|  |  |dbo.Sales | Product Packaging Size | 0.0 | decimal (18,2)  |  True|
|  |  |dbo.Sales | Product Packaging UOM | 'N/A' | nvarchar(20)  |  True|
|  |  |dbo.Sales | Product Quality | 0.0 | decimal (18,2)  |  True|
|  |  |dbo.Sales | New Files | NULL |    |  True|
|  |  |dbo.Sales | Shares | NULL |  |  True|
| |  |dbo.Sales | External Reference | '' | nvarchar(1000) |  True|
| |  |dbo.Sales | M Quantity | 0.00 | decimal (38, 5)   |  True|
| |  |dbo.Sales | M Quantity in MT | 0.00 | decimal (38, 5) |  True|
| |  |dbo.Sales | M Sales Amount Invoice Currency | 0.00 | float |  True|
| |  |dbo.Sales | M Sales Amount Home Currency | 0.00 | float |  True|
| |  |dbo.Sales | M Sales Amount Group Currency | 0.00 | float |  True|
| |  |dbo.Sales | M COGS Amount Home Currency | 0.00 | float |  True|
| |  |dbo.Sales | M COGS Amount Group Currency | 0.00 | float |  True|
| |  |dbo.Sales | M Contribution Home Currency |0.00 | float |  True|
| |  |dbo.Sales | M Contribution Group Currency |0.00 | float |  True|
| |  |dbo.Sales | M Cost External Transport Amount Home Currency |0.00 | float |  True|
| | |dbo.Sales | M Cost External Transport Amount  Group Currency |0.00 | float |  True|
| | |dbo.Sales | M Cost Internal Transport Amount Home Currency |0.00 | float |  True|
|  | |dbo.Sales | M Cost Internal Transport Amount  Group Currency | 0.00 | float |  True|
| | |dbo.Sales | M COGS2 Amount Home Currency |0.00 | float |  True|
|  | |dbo.Sales | M COGS2 Amount  Group Currency | 0.00 | float |  True|
|  | |dbo.Sales | M Contribution2 Home Currency |0.00 | float |  True|
|  | |dbo.Sales | M Contribution2 Group Currency |0.00 | float |  True|
| |  |dbo.Sales | M Unit Price Home Currency |0.00 | float |  True|
|  |  |dbo.Sales | M Unit Price Group Currency |0.00 | float |  True|
|dwh.Fact_SalesPlans  |BudgetAmountBudgetCurrency  |dbo.Sales | M Budget Amount Budget Currency | None | float |  |
| dwh.Fact_SalesPlans | BudgetAmountHomeCurrency |dbo.Sales | M Budget Amount Home Currency | None | float |  |
|  dwh.Fact_SalesPlans| BudgetAmountGroupCurrency |dbo.Sales | M Budget Amount Group Currency | None | float |  |
| dwh.Fact_SalesPlans | BudgetCostOfGoodsSold1AmountBudgetCurrency |dbo.Sales | M Budget COGS1 Amount Budget Currency | None | float |  |
| dwh.Fact_SalesPlans | BudgetCostOfGoodsSold1AmountHomeCurrency |dbo.Sales | M Budget COGS1  Amount Home Currency | None | float |  |
|dwh.Fact_SalesPlans  | BudgetCostOfGoodsSold1AmountGroupCurrency |dbo.Sales | M Budget COGS1 Amount Group Currency | None | float |  |
| dwh.Fact_SalesPlans | BudgetContribution1AmountBudgetCurrency |dbo.Sales | M Budget Contribution Budget Currency | None | float |  |
|dwh.Fact_SalesPlans  | BudgetContribution1AmountHomeCurrency |dbo.Sales | M Budget Contribution Home Currency | None | float |  |
|dwh.Fact_SalesPlans  | BudgetContribution1AmountGroupCurrency |dbo.Sales | M Budget Contribution Group Currency | None | float |  |
| dwh.Fact_SalesPlans | BudgetCostOfGoodsSold2AmountBudgetCurrency |dbo.Sales | M Budget COGS2 Amount Budget Currency | None | float |  |
| dwh.Fact_SalesPlans | BudgetCostOfGoodsSold2AmountHomeCurrency |dbo.Sales | M Budget COGS2  Amount Home Currency | None | float |  |
| dwh.Fact_SalesPlans |BudgetCostOfGoodsSold2AmountGroupCurrency|dbo.Sales | M Budget COGS2 Amount Group Currency | None | float |  |
| dwh.Fact_SalesPlans |BudgetContribution2AmountBudgetCurrency  |dbo.Sales | M Budget Contribution2 Budget Currency | None | float |  |
|dwh.Fact_SalesPlans  | BudgetContribution2AmountHomeCurrency |dbo.Sales | M Budget Contribution2 Home Currency |None | float |  |
| dwh.Fact_SalesPlans |BudgetContribution2AmountGroupCurrency  |dbo.Sales | M Budget Contribution2 Group Currency | None | float |  |
| dwh.Fact_SalesPlans |BudgetQuantity  |dbo.Sales | M Budget Quantity |None | float |  |
| dwh.Fact_SalesPlans |BudgetQuantityInMetricTon|dbo.Sales | M Budget Quantity in MT | None | float |  |
|  |  |dbo.Sales | ActualBudget | 'Budget' | |  |
| dwh.Fact_SalesPlans| FK_BusinessType, FK_BusinessUnit,FK_Company,FK_Customer  |dbo.Sales |Security Key| CONCAT_WS('-', FK_BusinessType, FK_BusinessUnit, FK_Company, FK_Customer) | |  |
|  |  |dbo.Sales | UOM Code | 'N/A' | |  |
|  |  |dbo.Sales | UOM Name | 'N/A' | |  |
| dwh.Dim_Currency| CurrencyCode |dbo.Sales |Home Currency| None | nvarchar(20) |  False|
| dwh.Sec_KeyCombinations| KDP_SK|dbo.Sales |KeyCombination Key| None | bigint |  False|

---

## Transformation Rules

### Column Specific Transformation
1. PK Sales
`ROW_NUMBER() OVER (ORDER BY sp.[FK_Company], sp.[FK_ClosingDate], sp.[FK_Customer], sp.[FK_Product], sp.[SalesPlan], sp.[BudgetLineNumber]) * -1`

2. Invoice Key
`Set default value to -1`

3. Product Local Key
`Set default value to -1`

4. Set default value for these columns to 'N/A'
`'N/A' AS [Product Grade]`
	`'N/A' AS [Product Form]`
	`'N/A' AS [Product Packaging Type]`
`'N/A' AS [Product Packaging UOM]`
	`'N/A' AS [UOM Code]`
	`'N/A' AS [UOM Name]`

5. Set default value for these columns to 0.00
	`0.00 AS [Product Packaging Size]`
	`0.00 AS [Product Quality]`
`0.00 AS [M Quantity]`
	`0.00 AS [M Quantity in MT]`
	`0.00 AS [M Sales Amount Invoice Currency]`
	`0.00 AS [M Sales Amount Home Currency]`
	`0.00 AS [M Sales Amount Group Currency]`
	`0.00 AS [M COGS Amount Home Currency]`
	`0.00 AS [M COGS Amount Group Currency]`
	`0.00 AS [M Contribution Home Currency]`
	`0.00 AS [M Contribution Group Currency]`
	`0.00 AS [M Cost External Transport Amount Home Currency]`
	`0.00 AS [M Cost External Transport Amount Group Currency]`
	`0.00 AS [M Cost Internal Transport Amount Home Currency]`
	`0.00 AS [M Cost Internal Transport Amount Group Currency]`
	`0.00 AS [M COGS2 Amount Home Currency]`
	`0.00 AS [M COGS2 Amount Group Currency]`
	`0.00 AS [M Contribution2 Home Currency]`
	`0.00 AS [M Contribution2 Group Currency]`
	`0.00 AS [M Unit Price Home Currency]`
	`0.00 AS [M Unit Price Group Currency]`

6. Set default value for these columns to NULL
`NULL AS [New Files]`
	`NULL AS [Shares]`
	`'' AS [External Reference]`


7. ActualBudget set to Budget
`'Budget' AS [ActualBudget]`

10. Security Key
`CONCAT_WS('-', sp.[FK_BusinessType], sp.[FK_BusinessUnit], sp.[FK_Company], sp.[FK_Customer])`


### Joins `dwh.Fact_SalesPlans sp`

1. dwh.Dim_Customer cust
`LEFT join dwh.Dim_Customer cust on cust.KDP_SK = sp.FK_Customer`

2. dwh.Dim_Country ctr
`LEFT join dwh.Dim_Country ctr on ctr.CountryCode = cust.CountryCode`

3. dwh.Sec_KeyCombinations KC
`INNER JOIN	dwh.Sec_KeyCombinations	AS KC`
			`ON  sp.FK_BusinessType	= KC.FK_BusinessType`
			`AND sp.FK_Company		= KC.FK_Company`
			`AND sp.FK_BusinessUnit	= KC.FK_BusinessUnit`
			`AND	ctr.KDP_SK		= KC.FK_CustomerCountry`

4. dwh.Dim_Currency hcur
`LEFT OUTER JOIN [dwh].[Dim_Currency] hcur
	ON sp.[FK_HomeCurrency] = hcur.[KDP_SK]`

5. dwh.Fact_SalesPlans sp_max
`INNER JOIN
(`
	`SELECT
		MAX([SalesPlanVersion]) AS [SalesPlanVersion]`
		`,[FK_ClosingDate]
		,[SalesPlanCategory]`
	`FROM [dwh].[Fact_SalesPlans]
	WHERE
		[SalesPlanCategory] = 'Budget'`
	`GROUP BY
		[FK_ClosingDate]
		,[SalesPlanCategory]`
`) sp_max`
	`ON sp.[FK_ClosingDate] = sp_max.[FK_ClosingDate]`
	`AND sp.[SalesPlanCategory] = sp_max.[SalesPlanCategory]`
	`AND sp.[SalesPlanVersion] = sp_max.[SalesPlanVersion]`

6. Where clause
`WHERE
	sp.SalesPlanCategory = 'Budget'`



---


## 3rd table: ActualBudget: 'Forecast'

### Field Mapping

| Source Table | Source Field  | Target Table  | Target Field  | Transformation Rules  | Data Type | Nullable  |
|--|--|--|--|--|--|--|
| dwh.Fact_SalesPlans| FK_Company, FK_ClosingDate, FK_Customer,  FK_Product, SalesPlan, BudgetLineNumber |dbo.Sales|  PK_Sales| ROW_NUMBER() OVER (ORDER BY sp.[FK_Company], sp.[FK_ClosingDate], sp.[FK_Customer], sp.[FK_Product], sp.[SalesPlan], sp.[BudgetLineNumber]) * -1| bigint   |  False|
| |  |dbo.Sales |  Invoice Key | -1 | bigint   |  True|
| dwh.Fact_SalesPlans | FK_Company |dbo.Sales |  Company Key | None | bigint   |  True|
| dwh.Fact_SalesPlans| FK_ClosingDate |dbo.Sales |  Date Closing Key | None | int|  True|
| dwh.Fact_SalesPlans | FK_Customer |dbo.Sales |  Customer Key | None | bigint   |  True|
| dwh.Fact_SalesPlans | FK_Industry |dbo.Sales |  Industry Key | None | bigint   |  True|
| dwh.Fact_SalesPlans | FK_HomeCurrency |dbo.Sales |  Currency Key | None | bigint   |  True|
| dwh.Fact_SalesPlans | FK_BusinessUnit |dbo.Sales |  Business Unit Key | None | bigint   |  True|
| dwh.Fact_SalesPlans | FK_BusinessType |dbo.Sales |  Business Type Key | None | bigint   |  True|
| dwh.Fact_SalesPlans | FK_DestinationCountry |dbo.Sales | Destination Country Key | None | bigint   |  True|
| dwh.Fact_SalesPlans | FK_Product |dbo.Sales | Product Key | None | bigint   |  True|
| dwh.Fact_SalesPlans | FK_ProductGrouping |dbo.Sales | Product Groups Key | None | bigint   |  True|
|  |  |dbo.Sales | Product Local Key | -1 | bigint   |  True|
| dwh.Fact_SalesPlans | FK_UnitOfMeasure |dbo.Sales | UOM Key | None | bigint   |  True|
|  |  |dbo.Sales | Product Grade | 'N/A' | nvarchar(500)   |  True|
|  |  |dbo.Sales | Product Form | 'N/A' | nvarchar(500)   |  True|
|  |  |dbo.Sales | Product Packaging Type | 'N/A' | nvarchar(500)   |  True|
|  |  |dbo.Sales | Product Packaging Size | 0.0 | decimal (18,2)  |  True|
|  |  |dbo.Sales | Product Packaging UOM | 'N/A' | nvarchar(20)  |  True|
|  |  |dbo.Sales | Product Quality | 0.0 | decimal (18,2)  |  True|
|  |  |dbo.Sales | New Files | NULL |    |  True|
|  |  |dbo.Sales | Shares | NULL |  |  True|
| |  |dbo.Sales | External Reference | '' | nvarchar(1000) |  True|
| |  |dbo.Sales | M Quantity | 0.00 | decimal (38, 5)   |  True|
| |  |dbo.Sales | M Quantity in MT | 0.00 | decimal (38, 5) |  True|
| |  |dbo.Sales | M Sales Amount Invoice Currency | 0.00 | float |  True|
| |  |dbo.Sales | M Sales Amount Home Currency | 0.00 | float |  True|
| |  |dbo.Sales | M Sales Amount Group Currency | 0.00 | float |  True|
| |  |dbo.Sales | M COGS Amount Home Currency | 0.00 | float |  True|
| |  |dbo.Sales | M COGS Amount Group Currency | 0.00 | float |  True|
| |  |dbo.Sales | M Contribution Home Currency |0.00 | float |  True|
| |  |dbo.Sales | M Contribution Group Currency |0.00 | float |  True|
| |  |dbo.Sales | M Cost External Transport Amount Home Currency |0.00 | float |  True|
| | |dbo.Sales | M Cost External Transport Amount  Group Currency |0.00 | float |  True|
| | |dbo.Sales | M Cost Internal Transport Amount Home Currency |0.00 | float |  True|
|  | |dbo.Sales | M Cost Internal Transport Amount  Group Currency | 0.00 | float |  True|
| | |dbo.Sales | M COGS2 Amount Home Currency |0.00 | float |  True|
|  | |dbo.Sales | M COGS2 Amount  Group Currency | 0.00 | float |  True|
|  | |dbo.Sales | M Contribution2 Home Currency |0.00 | float |  True|
|  | |dbo.Sales | M Contribution2 Group Currency |0.00 | float |  True|
| |  |dbo.Sales | M Unit Price Home Currency |0.00 | float |  True|
|  |  |dbo.Sales | M Unit Price Group Currency |0.00 | float |  True|
|dwh.Fact_SalesPlans  |BudgetAmountBudgetCurrency  |dbo.Sales | M Budget Amount Budget Currency | None | float |  |
| dwh.Fact_SalesPlans | BudgetAmountHomeCurrency |dbo.Sales | M Budget Amount Home Currency | None | float |  |
|  dwh.Fact_SalesPlans| BudgetAmountGroupCurrency |dbo.Sales | M Budget Amount Group Currency | None | float |  |
| dwh.Fact_SalesPlans | BudgetCostOfGoodsSold1AmountBudgetCurrency |dbo.Sales | M Budget COGS1 Amount Budget Currency | None | float |  |
| dwh.Fact_SalesPlans | BudgetCostOfGoodsSold1AmountHomeCurrency |dbo.Sales | M Budget COGS1  Amount Home Currency | None | float |  |
|dwh.Fact_SalesPlans  | BudgetCostOfGoodsSold1AmountGroupCurrency |dbo.Sales | M Budget COGS1 Amount Group Currency | None | float |  |
| dwh.Fact_SalesPlans | BudgetContribution1AmountBudgetCurrency |dbo.Sales | M Budget Contribution Budget Currency | None | float |  |
|dwh.Fact_SalesPlans  | BudgetContribution1AmountHomeCurrency |dbo.Sales | M Budget Contribution Home Currency | None | float |  |
|dwh.Fact_SalesPlans  | BudgetContribution1AmountGroupCurrency |dbo.Sales | M Budget Contribution Group Currency | None | float |  |
| dwh.Fact_SalesPlans | BudgetCostOfGoodsSold2AmountBudgetCurrency |dbo.Sales | M Budget COGS2 Amount Budget Currency | None | float |  |
| dwh.Fact_SalesPlans | BudgetCostOfGoodsSold2AmountHomeCurrency |dbo.Sales | M Budget COGS2  Amount Home Currency | None | float |  |
| dwh.Fact_SalesPlans |BudgetCostOfGoodsSold2AmountGroupCurrency|dbo.Sales | M Budget COGS2 Amount Group Currency | None | float |  |
| dwh.Fact_SalesPlans |BudgetContribution2AmountBudgetCurrency  |dbo.Sales | M Budget Contribution2 Budget Currency | None | float |  |
|dwh.Fact_SalesPlans  | BudgetContribution2AmountHomeCurrency |dbo.Sales | M Budget Contribution2 Home Currency |None | float |  |
| dwh.Fact_SalesPlans |BudgetContribution2AmountGroupCurrency  |dbo.Sales | M Budget Contribution2 Group Currency | None | float |  |
| dwh.Fact_SalesPlans |BudgetQuantity  |dbo.Sales | M Budget Quantity |None | float |  |
| dwh.Fact_SalesPlans |BudgetQuantityInMetricTon|dbo.Sales | M Budget Quantity in MT | None | float |  |
|  |  |dbo.Sales | ActualBudget | 'Forecast' | |  |
| dwh.Fact_SalesPlans| FK_BusinessType, FK_BusinessUnit,FK_Company,FK_Customer  |dbo.Sales |Security Key| CONCAT_WS('-', FK_BusinessType, FK_BusinessUnit, FK_Company, FK_Customer) | |  |
|  |  |dbo.Sales | UOM Code | 'N/A' | |  |
|  |  |dbo.Sales | UOM Name | 'N/A' | |  |
| dwh.Dim_Currency| CurrencyCode |dbo.Sales |Home Currency| None | nvarchar(20) |  False|
| dwh.Sec_KeyCombinations| KDP_SK|dbo.Sales |KeyCombination Key| None | bigint |  False|
---

## Transformation Rules

### Column Specific Transformation
1. PK Sales
`ROW_NUMBER() OVER (ORDER BY sp.[FK_Company], sp.[FK_ClosingDate], sp.[FK_Customer], sp.[FK_Product], sp.[SalesPlan], sp.[BudgetLineNumber]) * -1`

2. Invoice Key
`Set default value to -1`

3. Product Local Key
`Set default value to -1`

4. Set default value for these columns to 'N/A'
`'N/A' AS [Product Grade]`
	`'N/A' AS [Product Form]`
	`'N/A' AS [Product Packaging Type]`
`'N/A' AS [Product Packaging UOM]`
	`'N/A' AS [UOM Code]`
	`'N/A' AS [UOM Name]`

5. Set default value for these columns to 0.00
	`0.00 AS [Product Packaging Size]`
	`0.00 AS [Product Quality]`
`0.00 AS [M Quantity]`
	`0.00 AS [M Quantity in MT]`
	`0.00 AS [M Sales Amount Invoice Currency]`
	`0.00 AS [M Sales Amount Home Currency]`
	`0.00 AS [M Sales Amount Group Currency]`
	`0.00 AS [M COGS Amount Home Currency]`
	`0.00 AS [M COGS Amount Group Currency]`
	`0.00 AS [M Contribution Home Currency]`
	`0.00 AS [M Contribution Group Currency]`
	`0.00 AS [M Cost External Transport Amount Home Currency]`
	`0.00 AS [M Cost External Transport Amount Group Currency]`
	`0.00 AS [M Cost Internal Transport Amount Home Currency]`
	`0.00 AS [M Cost Internal Transport Amount Group Currency]`
	`0.00 AS [M COGS2 Amount Home Currency]`
	`0.00 AS [M COGS2 Amount Group Currency]`
	`0.00 AS [M Contribution2 Home Currency]`
	`0.00 AS [M Contribution2 Group Currency]`
	`0.00 AS [M Unit Price Home Currency]`
	`0.00 AS [M Unit Price Group Currency]`

6. Set default value for these columns to NULL
`NULL AS [New Files]`
	`NULL AS [Shares]`
	`'' AS [External Reference]`


7. ActualBudget set to Forecast
`'Forecast' AS [ActualBudget]`

10. Security Key
`CONCAT_WS('-', sp.[FK_BusinessType], sp.[FK_BusinessUnit], sp.[FK_Company], sp.[FK_Customer])`


### Joins `dwh.Fact_SalesPlans sp`

1. dwh.Dim_Customer cust
`LEFT join dwh.Dim_Customer cust on cust.KDP_SK = sp.FK_Customer`

2. dwh.Dim_Country ctr
`LEFT join dwh.Dim_Country ctr on ctr.CountryCode = cust.CountryCode`

3. dwh.Sec_KeyCombinations KC
`INNER JOIN	dwh.Sec_KeyCombinations	AS KC`
			`ON  sp.FK_BusinessType	= KC.FK_BusinessType`
			`AND sp.FK_Company		= KC.FK_Company`
			`AND sp.FK_BusinessUnit	= KC.FK_BusinessUnit`
			`AND	ctr.KDP_SK		= KC.FK_CustomerCountry`

4. dwh.Dim_Currency hcur
`LEFT OUTER JOIN [dwh].[Dim_Currency] hcur
	ON sp.[FK_HomeCurrency] = hcur.[KDP_SK]`

5. dwh.Fact_SalesPlans sp_max
`INNER JOIN
(`
	`SELECT
		MAX([SalesPlanVersion]) AS [SalesPlanVersion]`
		`,[FK_ClosingDate]
		,[SalesPlanCategory]`
	`FROM [dwh].[Fact_SalesPlans]
	WHERE
		[SalesPlanCategory] = 'Budget'`
	`GROUP BY
		[FK_ClosingDate]
		,[SalesPlanCategory]`
`) sp_max`
	`ON sp.[FK_ClosingDate] = sp_max.[FK_ClosingDate]`
	`AND sp.[SalesPlanCategory] = sp_max.[SalesPlanCategory]`
	`AND sp.[SalesPlanVersion] = sp_max.[SalesPlanVersion]`

6. Where clause
`WHERE
	sp.SalesPlanCategory = 'Forecast'`


---
### UNION ALL

Once you have these 3 tables, it's combined using Union ALL 

---
### [Return to Fact Tables](/Archive/Data-Lineage/Fact-Tables)