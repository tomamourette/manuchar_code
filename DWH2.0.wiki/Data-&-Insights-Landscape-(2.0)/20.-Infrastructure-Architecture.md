# Infrastructure architecture
This page outlines the platforms and environments that host the Data BackBone workloads. It connects programme level decisions with the concrete assets living in Microsoft Fabric and Azure DevOps.

## Fabric workspaces and environments
| Environment | Branch | Workspace identifier | Primary use |
| --- | --- | --- | --- |
| TST | `test` | `913a2dc2-5f68-4fb7-ab07-631a84561fd6` | System testing, integration shake-out, automated regression runs |
| ACC | `acceptance` | `$workspace.id` (set by release pipeline) | User acceptance testing with finance stakeholders |
| QUAL | `quality` | `$workspace.id` (set by release pipeline) | Performance testing, dry run of monthly close |
| PRD | `production` | `$workspace.id` (set by release pipeline) | Live data products and reporting |

> The release pipeline replaces the placeholder `$workspace.id` values in `fabric/parameter.yml` with the target workspace id for each environment. The repository only stores the TST identifier; the others are injected at deploy time to keep secrets out of source control.

## Fabric item layout
All environments share the same item structure under the workspace:
- `dbb_lakehouse.Lakehouse` stores bronze assets, raw unloads and curated delta tables.
- `dbb_warehouse.Warehouse` exposes silver and gold tables to dbt and Power BI via the SQL analytics endpoint.
- Pipelines under `fabric/integration` land source data, trigger incremental loads and register monitoring entries.
- Pipelines under `fabric/transformation` orchestrate dbt model refresh and notebook based rewrites.
- Monitoring and maintenance notebooks provide observability and upkeep actions.

The repository mirrors this structure under the `fabric/` folder so that deployments are reproducible.

## Storage and connectivity
- Raw and curated files reside in OneLake under `https://onelake.blob.fabric.microsoft.com/{workspace}/{lakehouse}/Files`.
- Source system connectivity uses Fabric Lakehouse or SQL connections whose identifiers are defined in `integration/integration_source_connections.csv`.
- The dbt project connects through the Fabric SQL endpoint referenced by the `FAB_DBB_DBT_ENDPOINT` environment variable (see `transformation/dbt/profiles.yml`).

## Supporting Azure services
- Azure DevOps hosts Git repositories, work items and CI/CD pipelines.
- Service principals per environment authenticate deployments; credentials are stored in variable groups (`variable_fabric_dbb_*`).
- Azure Monitor captures pipeline run telemetry; alerts route to the data engineering on-call channel.

## Access model
- Workspace level roles split engineering (Admin), operations (Member) and consumers (Viewer) duties.
- Lakehouse folder permissions segregate raw, curated and restricted zones. Entra ID groups map to consumer personas.
- Semantic model level Row Level Security (see [[Data-BackBone-Solution-Design-Documentation/60.-Security.md]]) ensures only authorised users can see finance sensitive measures.

## Change control
1. Infrastructure changes (new workspaces, capacity adjustments, service principals) are raised as Architecture Decision Records and stored in this section.
2. Implement approved changes using Terraform or scripted Fabric admin commands where possible; document manual steps in the runbook.
3. Update this page with the resulting configuration so the platform inventory stays accurate.
